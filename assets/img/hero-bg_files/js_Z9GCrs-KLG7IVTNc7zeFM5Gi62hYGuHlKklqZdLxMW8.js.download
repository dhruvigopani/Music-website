
/**
 * Cookie plugin 1.0
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};
;
(function ($) {

/**
 * Retrieves the summary for the first element.
 */
$.fn.drupalGetSummary = function () {
  var callback = this.data('summaryCallback');
  return (this[0] && callback) ? $.trim(callback(this[0])) : '';
};

/**
 * Sets the summary for all matched elements.
 *
 * @param callback
 *   Either a function that will be called each time the summary is
 *   retrieved or a string (which is returned each time).
 */
$.fn.drupalSetSummary = function (callback) {
  var self = this;

  // To facilitate things, the callback should always be a function. If it's
  // not, we wrap it into an anonymous function which just returns the value.
  if (typeof callback != 'function') {
    var val = callback;
    callback = function () { return val; };
  }

  return this
    .data('summaryCallback', callback)
    // To prevent duplicate events, the handlers are first removed and then
    // (re-)added.
    .unbind('formUpdated.summary')
    .bind('formUpdated.summary', function () {
      self.trigger('summaryUpdated');
    })
    // The actual summaryUpdated handler doesn't fire when the callback is
    // changed, so we have to do this manually.
    .trigger('summaryUpdated');
};

/**
 * Sends a 'formUpdated' event each time a form element is modified.
 */
Drupal.behaviors.formUpdated = {
  attach: function (context) {
    // These events are namespaced so that we can remove them later.
    var events = 'change.formUpdated click.formUpdated blur.formUpdated keyup.formUpdated';
    $(context)
      // Since context could be an input element itself, it's added back to
      // the jQuery object and filtered again.
      .find(':input').andSelf().filter(':input')
      // To prevent duplicate events, the handlers are first removed and then
      // (re-)added.
      .unbind(events).bind(events, function () {
        $(this).trigger('formUpdated');
      });
  }
};

/**
 * Prepopulate form fields with information from the visitor cookie.
 */
Drupal.behaviors.fillUserInfoFromCookie = {
  attach: function (context, settings) {
    $('form.user-info-from-cookie').once('user-info-from-cookie', function () {
      var formContext = this;
      $.each(['name', 'mail', 'homepage'], function () {
        var $element = $('[name=' + this + ']', formContext);
        var cookie = $.cookie('Drupal.visitor.' + this);
        if ($element.length && cookie) {
          $element.val(cookie);
        }
      });
    });
  }
};

})(jQuery);
;
(function ($) {

/**
 * Provides Ajax page updating via jQuery $.ajax (Asynchronous JavaScript and XML).
 *
 * Ajax is a method of making a request via JavaScript while viewing an HTML
 * page. The request returns an array of commands encoded in JSON, which is
 * then executed to make any changes that are necessary to the page.
 *
 * Drupal uses this file to enhance form elements with #ajax['path'] and
 * #ajax['wrapper'] properties. If set, this file will automatically be included
 * to provide Ajax capabilities.
 */

Drupal.ajax = Drupal.ajax || {};

Drupal.settings.urlIsAjaxTrusted = Drupal.settings.urlIsAjaxTrusted || {};

/**
 * Attaches the Ajax behavior to each Ajax form element.
 */
Drupal.behaviors.AJAX = {
  attach: function (context, settings) {
    // Load all Ajax behaviors specified in the settings.
    for (var base in settings.ajax) {
      if (!$('#' + base + '.ajax-processed').length) {
        var element_settings = settings.ajax[base];

        if (typeof element_settings.selector == 'undefined') {
          element_settings.selector = '#' + base;
        }
        $(element_settings.selector).each(function () {
          element_settings.element = this;
          Drupal.ajax[base] = new Drupal.ajax(base, this, element_settings);
        });

        $('#' + base).addClass('ajax-processed');
      }
    }

    // Bind Ajax behaviors to all items showing the class.
    $('.use-ajax:not(.ajax-processed)').addClass('ajax-processed').each(function () {
      var element_settings = {};
      // Clicked links look better with the throbber than the progress bar.
      element_settings.progress = { 'type': 'throbber' };

      // For anchor tags, these will go to the target of the anchor rather
      // than the usual location.
      if ($(this).attr('href')) {
        element_settings.url = $(this).attr('href');
        element_settings.event = 'click';
      }
      var base = $(this).attr('id');
      Drupal.ajax[base] = new Drupal.ajax(base, this, element_settings);
    });

    // This class means to submit the form to the action using Ajax.
    $('.use-ajax-submit:not(.ajax-processed)').addClass('ajax-processed').each(function () {
      var element_settings = {};

      // Ajax submits specified in this manner automatically submit to the
      // normal form action.
      element_settings.url = $(this.form).attr('action');
      // Form submit button clicks need to tell the form what was clicked so
      // it gets passed in the POST request.
      element_settings.setClick = true;
      // Form buttons use the 'click' event rather than mousedown.
      element_settings.event = 'click';
      // Clicked form buttons look better with the throbber than the progress bar.
      element_settings.progress = { 'type': 'throbber' };

      var base = $(this).attr('id');
      Drupal.ajax[base] = new Drupal.ajax(base, this, element_settings);
    });
  }
};

/**
 * Ajax object.
 *
 * All Ajax objects on a page are accessible through the global Drupal.ajax
 * object and are keyed by the submit button's ID. You can access them from
 * your module's JavaScript file to override properties or functions.
 *
 * For example, if your Ajax enabled button has the ID 'edit-submit', you can
 * redefine the function that is called to insert the new content like this
 * (inside a Drupal.behaviors attach block):
 * @code
 *    Drupal.behaviors.myCustomAJAXStuff = {
 *      attach: function (context, settings) {
 *        Drupal.ajax['edit-submit'].commands.insert = function (ajax, response, status) {
 *          new_content = $(response.data);
 *          $('#my-wrapper').append(new_content);
 *          alert('New content was appended to #my-wrapper');
 *        }
 *      }
 *    };
 * @endcode
 */
Drupal.ajax = function (base, element, element_settings) {
  var defaults = {
    url: 'system/ajax',
    event: 'mousedown',
    keypress: true,
    selector: '#' + base,
    effect: 'none',
    speed: 'none',
    method: 'replaceWith',
    progress: {
      type: 'throbber',
      message: Drupal.t('Please wait...')
    },
    submit: {
      'js': true
    }
  };

  $.extend(this, defaults, element_settings);

  this.element = element;
  this.element_settings = element_settings;

  // Replacing 'nojs' with 'ajax' in the URL allows for an easy method to let
  // the server detect when it needs to degrade gracefully.
  // There are five scenarios to check for:
  // 1. /nojs/
  // 2. /nojs$ - The end of a URL string.
  // 3. /nojs? - Followed by a query (with clean URLs enabled).
  //      E.g.: path/nojs?destination=foobar
  // 4. /nojs& - Followed by a query (without clean URLs enabled).
  //      E.g.: ?q=path/nojs&destination=foobar
  // 5. /nojs# - Followed by a fragment.
  //      E.g.: path/nojs#myfragment
  this.url = element_settings.url.replace(/\/nojs(\/|$|\?|&|#)/g, '/ajax$1');
  // If the 'nojs' version of the URL is trusted, also trust the 'ajax' version.
  if (Drupal.settings.urlIsAjaxTrusted[element_settings.url]) {
    Drupal.settings.urlIsAjaxTrusted[this.url] = true;
  }

  this.wrapper = '#' + element_settings.wrapper;

  // If there isn't a form, jQuery.ajax() will be used instead, allowing us to
  // bind Ajax to links as well.
  if (this.element.form) {
    this.form = $(this.element.form);
  }

  // Set the options for the ajaxSubmit function.
  // The 'this' variable will not persist inside of the options object.
  var ajax = this;
  ajax.options = {
    url: Drupal.sanitizeAjaxUrl(ajax.url),
    data: ajax.submit,
    beforeSerialize: function (element_settings, options) {
      return ajax.beforeSerialize(element_settings, options);
    },
    beforeSubmit: function (form_values, element_settings, options) {
      ajax.ajaxing = true;
      return ajax.beforeSubmit(form_values, element_settings, options);
    },
    beforeSend: function (xmlhttprequest, options) {
      ajax.ajaxing = true;
      return ajax.beforeSend(xmlhttprequest, options);
    },
    success: function (response, status, xmlhttprequest) {
      // Sanity check for browser support (object expected).
      // When using iFrame uploads, responses must be returned as a string.
      if (typeof response == 'string') {
        response = $.parseJSON(response);
      }

      // Prior to invoking the response's commands, verify that they can be
      // trusted by checking for a response header. See
      // ajax_set_verification_header() for details.
      // - Empty responses are harmless so can bypass verification. This avoids
      //   an alert message for server-generated no-op responses that skip Ajax
      //   rendering.
      // - Ajax objects with trusted URLs (e.g., ones defined server-side via
      //   #ajax) can bypass header verification. This is especially useful for
      //   Ajax with multipart forms. Because IFRAME transport is used, the
      //   response headers cannot be accessed for verification.
      if (response !== null && !Drupal.settings.urlIsAjaxTrusted[ajax.url]) {
        if (xmlhttprequest.getResponseHeader('X-Drupal-Ajax-Token') !== '1') {
          var customMessage = Drupal.t("The response failed verification so will not be processed.");
          return ajax.error(xmlhttprequest, ajax.url, customMessage);
        }
      }

      return ajax.success(response, status);
    },
    complete: function (xmlhttprequest, status) {
      ajax.ajaxing = false;
      if (status == 'error' || status == 'parsererror') {
        return ajax.error(xmlhttprequest, ajax.url);
      }
    },
    dataType: 'json',
    jsonp: false,
    type: 'POST'
  };

  // For multipart forms (e.g., file uploads), jQuery Form targets the form
  // submission to an iframe instead of using an XHR object. The initial "src"
  // of the iframe, prior to the form submission, is set to options.iframeSrc.
  // "about:blank" is the semantically correct, standards-compliant, way to
  // initialize a blank iframe; however, some old IE versions (possibly only 6)
  // incorrectly report a mixed content warning when iframes with an
  // "about:blank" src are added to a parent document with an https:// origin.
  // jQuery Form works around this by defaulting to "javascript:false" instead,
  // but that breaks on Chrome 83, so here we force the semantically correct
  // behavior for all browsers except old IE.
  // @see https://www.drupal.org/project/drupal/issues/3143016
  // @see https://github.com/jquery-form/form/blob/df9cb101b9c9c085c8d75ad980c7ff1cf62063a1/jquery.form.js#L68
  // @see https://bugs.chromium.org/p/chromium/issues/detail?id=1084874
  // @see https://html.spec.whatwg.org/multipage/browsers.html#creating-browsing-contexts
  // @see https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy
  if (navigator.userAgent.indexOf("MSIE") === -1) {
    ajax.options.iframeSrc = 'about:blank';
  }

  // Bind the ajaxSubmit function to the element event.
  $(ajax.element).bind(element_settings.event, function (event) {
    if (!Drupal.settings.urlIsAjaxTrusted[ajax.url] && !Drupal.urlIsLocal(ajax.url)) {
      throw new Error(Drupal.t('The callback URL is not local and not trusted: !url', {'!url': ajax.url}));
    }
    return ajax.eventResponse(this, event);
  });

  // If necessary, enable keyboard submission so that Ajax behaviors
  // can be triggered through keyboard input as well as e.g. a mousedown
  // action.
  if (element_settings.keypress) {
    $(ajax.element).keypress(function (event) {
      return ajax.keypressResponse(this, event);
    });
  }

  // If necessary, prevent the browser default action of an additional event.
  // For example, prevent the browser default action of a click, even if the
  // AJAX behavior binds to mousedown.
  if (element_settings.prevent) {
    $(ajax.element).bind(element_settings.prevent, false);
  }
};

/**
 * Handle a key press.
 *
 * The Ajax object will, if instructed, bind to a key press response. This
 * will test to see if the key press is valid to trigger this event and
 * if it is, trigger it for us and prevent other keypresses from triggering.
 * In this case we're handling RETURN and SPACEBAR keypresses (event codes 13
 * and 32. RETURN is often used to submit a form when in a textfield, and 
 * SPACE is often used to activate an element without submitting. 
 */
Drupal.ajax.prototype.keypressResponse = function (element, event) {
  // Create a synonym for this to reduce code confusion.
  var ajax = this;

  // Detect enter key and space bar and allow the standard response for them,
  // except for form elements of type 'text' and 'textarea', where the 
  // spacebar activation causes inappropriate activation if #ajax['keypress'] is 
  // TRUE. On a text-type widget a space should always be a space.
  if (event.which == 13 || (event.which == 32 && element.type != 'text' && element.type != 'textarea')) {
    $(ajax.element_settings.element).trigger(ajax.element_settings.event);
    return false;
  }
};

/**
 * Handle an event that triggers an Ajax response.
 *
 * When an event that triggers an Ajax response happens, this method will
 * perform the actual Ajax call. It is bound to the event using
 * bind() in the constructor, and it uses the options specified on the
 * ajax object.
 */
Drupal.ajax.prototype.eventResponse = function (element, event) {
  // Create a synonym for this to reduce code confusion.
  var ajax = this;

  // Do not perform another ajax command if one is already in progress.
  if (ajax.ajaxing) {
    return false;
  }

  try {
    if (ajax.form) {
      // If setClick is set, we must set this to ensure that the button's
      // value is passed.
      if (ajax.setClick) {
        // Mark the clicked button. 'form.clk' is a special variable for
        // ajaxSubmit that tells the system which element got clicked to
        // trigger the submit. Without it there would be no 'op' or
        // equivalent.
        element.form.clk = element;
      }

      ajax.form.ajaxSubmit(ajax.options);
    }
    else {
      ajax.beforeSerialize(ajax.element, ajax.options);
      $.ajax(ajax.options);
    }
  }
  catch (e) {
    // Unset the ajax.ajaxing flag here because it won't be unset during
    // the complete response.
    ajax.ajaxing = false;
    alert("An error occurred while attempting to process " + ajax.options.url + ": " + e.message);
  }

  // For radio/checkbox, allow the default event. On IE, this means letting
  // it actually check the box.
  if (typeof element.type != 'undefined' && (element.type == 'checkbox' || element.type == 'radio')) {
    return true;
  }
  else {
    return false;
  }

};

/**
 * Handler for the form serialization.
 *
 * Runs before the beforeSend() handler (see below), and unlike that one, runs
 * before field data is collected.
 */
Drupal.ajax.prototype.beforeSerialize = function (element, options) {
  // Allow detaching behaviors to update field values before collecting them.
  // This is only needed when field values are added to the POST data, so only
  // when there is a form such that this.form.ajaxSubmit() is used instead of
  // $.ajax(). When there is no form and $.ajax() is used, beforeSerialize()
  // isn't called, but don't rely on that: explicitly check this.form.
  if (this.form) {
    var settings = this.settings || Drupal.settings;
    Drupal.detachBehaviors(this.form, settings, 'serialize');
  }

  // Prevent duplicate HTML ids in the returned markup.
  // @see drupal_html_id()
  options.data['ajax_html_ids[]'] = [];
  $('[id]').each(function () {
    options.data['ajax_html_ids[]'].push(this.id);
  });

  // Allow Drupal to return new JavaScript and CSS files to load without
  // returning the ones already loaded.
  // @see ajax_base_page_theme()
  // @see drupal_get_css()
  // @see drupal_get_js()
  options.data['ajax_page_state[theme]'] = Drupal.settings.ajaxPageState.theme;
  options.data['ajax_page_state[theme_token]'] = Drupal.settings.ajaxPageState.theme_token;
  for (var key in Drupal.settings.ajaxPageState.css) {
    options.data['ajax_page_state[css][' + key + ']'] = 1;
  }
  for (var key in Drupal.settings.ajaxPageState.js) {
    options.data['ajax_page_state[js][' + key + ']'] = 1;
  }
};

/**
 * Modify form values prior to form submission.
 */
Drupal.ajax.prototype.beforeSubmit = function (form_values, element, options) {
  // This function is left empty to make it simple to override for modules
  // that wish to add functionality here.
};

/**
 * Prepare the Ajax request before it is sent.
 */
Drupal.ajax.prototype.beforeSend = function (xmlhttprequest, options) {
  // For forms without file inputs, the jQuery Form plugin serializes the form
  // values, and then calls jQuery's $.ajax() function, which invokes this
  // handler. In this circumstance, options.extraData is never used. For forms
  // with file inputs, the jQuery Form plugin uses the browser's normal form
  // submission mechanism, but captures the response in a hidden IFRAME. In this
  // circumstance, it calls this handler first, and then appends hidden fields
  // to the form to submit the values in options.extraData. There is no simple
  // way to know which submission mechanism will be used, so we add to extraData
  // regardless, and allow it to be ignored in the former case.
  if (this.form) {
    options.extraData = options.extraData || {};

    // Let the server know when the IFRAME submission mechanism is used. The
    // server can use this information to wrap the JSON response in a TEXTAREA,
    // as per http://jquery.malsup.com/form/#file-upload.
    options.extraData.ajax_iframe_upload = '1';

    // The triggering element is about to be disabled (see below), but if it
    // contains a value (e.g., a checkbox, textfield, select, etc.), ensure that
    // value is included in the submission. As per above, submissions that use
    // $.ajax() are already serialized prior to the element being disabled, so
    // this is only needed for IFRAME submissions.
    var v = $.fieldValue(this.element);
    if (v !== null) {
      options.extraData[this.element.name] = Drupal.checkPlain(v);
    }
  }

  // Disable the element that received the change to prevent user interface
  // interaction while the Ajax request is in progress. ajax.ajaxing prevents
  // the element from triggering a new request, but does not prevent the user
  // from changing its value.
  $(this.element).addClass('progress-disabled').attr('disabled', true);

  // Insert progressbar or throbber.
  if (this.progress.type == 'bar') {
    var progressBar = new Drupal.progressBar('ajax-progress-' + this.element.id, $.noop, this.progress.method, $.noop);
    if (this.progress.message) {
      progressBar.setProgress(-1, this.progress.message);
    }
    if (this.progress.url) {
      progressBar.startMonitoring(this.progress.url, this.progress.interval || 1500);
    }
    this.progress.element = $(progressBar.element).addClass('ajax-progress ajax-progress-bar');
    this.progress.object = progressBar;
    $(this.element).after(this.progress.element);
  }
  else if (this.progress.type == 'throbber') {
    this.progress.element = $('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');
    if (this.progress.message) {
      $('.throbber', this.progress.element).after('<div class="message">' + this.progress.message + '</div>');
    }
    $(this.element).after(this.progress.element);
  }
};

/**
 * Handler for the form redirection completion.
 */
Drupal.ajax.prototype.success = function (response, status) {
  // Remove the progress element.
  if (this.progress.element) {
    $(this.progress.element).remove();
  }
  if (this.progress.object) {
    this.progress.object.stopMonitoring();
  }
  $(this.element).removeClass('progress-disabled').removeAttr('disabled');

  Drupal.freezeHeight();

  for (var i in response) {
    if (response.hasOwnProperty(i) && response[i]['command'] && this.commands[response[i]['command']]) {
      this.commands[response[i]['command']](this, response[i], status);
    }
  }

  // Reattach behaviors, if they were detached in beforeSerialize(). The
  // attachBehaviors() called on the new content from processing the response
  // commands is not sufficient, because behaviors from the entire form need
  // to be reattached.
  if (this.form) {
    var settings = this.settings || Drupal.settings;
    Drupal.attachBehaviors(this.form, settings);
  }

  Drupal.unfreezeHeight();

  // Remove any response-specific settings so they don't get used on the next
  // call by mistake.
  this.settings = null;
};

/**
 * Build an effect object which tells us how to apply the effect when adding new HTML.
 */
Drupal.ajax.prototype.getEffect = function (response) {
  var type = response.effect || this.effect;
  var speed = response.speed || this.speed;

  var effect = {};
  if (type == 'none') {
    effect.showEffect = 'show';
    effect.hideEffect = 'hide';
    effect.showSpeed = '';
  }
  else if (type == 'fade') {
    effect.showEffect = 'fadeIn';
    effect.hideEffect = 'fadeOut';
    effect.showSpeed = speed;
  }
  else {
    effect.showEffect = type + 'Toggle';
    effect.hideEffect = type + 'Toggle';
    effect.showSpeed = speed;
  }

  return effect;
};

/**
 * Handler for the form redirection error.
 */
Drupal.ajax.prototype.error = function (xmlhttprequest, uri, customMessage) {
  Drupal.displayAjaxError(Drupal.ajaxError(xmlhttprequest, uri, customMessage));
  // Remove the progress element.
  if (this.progress.element) {
    $(this.progress.element).remove();
  }
  if (this.progress.object) {
    this.progress.object.stopMonitoring();
  }
  // Undo hide.
  $(this.wrapper).show();
  // Re-enable the element.
  $(this.element).removeClass('progress-disabled').removeAttr('disabled');
  // Reattach behaviors, if they were detached in beforeSerialize().
  if (this.form) {
    var settings = this.settings || Drupal.settings;
    Drupal.attachBehaviors(this.form, settings);
  }
};

/**
 * Provide a series of commands that the server can request the client perform.
 */
Drupal.ajax.prototype.commands = {
  /**
   * Command to insert new content into the DOM.
   */
  insert: function (ajax, response, status) {
    // Get information from the response. If it is not there, default to
    // our presets.
    var wrapper = response.selector ? $(response.selector) : $(ajax.wrapper);
    var method = response.method || ajax.method;
    var effect = ajax.getEffect(response);

    // We don't know what response.data contains: it might be a string of text
    // without HTML, so don't rely on jQuery correctly iterpreting
    // $(response.data) as new HTML rather than a CSS selector. Also, if
    // response.data contains top-level text nodes, they get lost with either
    // $(response.data) or $('<div></div>').replaceWith(response.data).
    var new_content_wrapped = $('<div></div>').html(response.data);
    var new_content = new_content_wrapped.contents();

    // For legacy reasons, the effects processing code assumes that new_content
    // consists of a single top-level element. Also, it has not been
    // sufficiently tested whether attachBehaviors() can be successfully called
    // with a context object that includes top-level text nodes. However, to
    // give developers full control of the HTML appearing in the page, and to
    // enable Ajax content to be inserted in places where DIV elements are not
    // allowed (e.g., within TABLE, TR, and SPAN parents), we check if the new
    // content satisfies the requirement of a single top-level element, and
    // only use the container DIV created above when it doesn't. For more
    // information, please see http://drupal.org/node/736066.
    if (new_content.length != 1 || new_content.get(0).nodeType != 1) {
      new_content = new_content_wrapped;
    }

    // If removing content from the wrapper, detach behaviors first.
    switch (method) {
      case 'html':
      case 'replaceWith':
      case 'replaceAll':
      case 'empty':
      case 'remove':
        var settings = response.settings || ajax.settings || Drupal.settings;
        Drupal.detachBehaviors(wrapper, settings);
    }

    // Add the new content to the page.
    wrapper[method](new_content);

    // Immediately hide the new content if we're using any effects.
    if (effect.showEffect != 'show') {
      new_content.hide();
    }

    // Determine which effect to use and what content will receive the
    // effect, then show the new content.
    if ($('.ajax-new-content', new_content).length > 0) {
      $('.ajax-new-content', new_content).hide();
      new_content.show();
      $('.ajax-new-content', new_content)[effect.showEffect](effect.showSpeed);
    }
    else if (effect.showEffect != 'show') {
      new_content[effect.showEffect](effect.showSpeed);
    }

    // Attach all JavaScript behaviors to the new content, if it was successfully
    // added to the page, this if statement allows #ajax['wrapper'] to be
    // optional.
    if (new_content.parents('html').length > 0) {
      // Apply any settings from the returned JSON if available.
      var settings = response.settings || ajax.settings || Drupal.settings;
      Drupal.attachBehaviors(new_content, settings);
    }
  },

  /**
   * Command to remove a chunk from the page.
   */
  remove: function (ajax, response, status) {
    var settings = response.settings || ajax.settings || Drupal.settings;
    Drupal.detachBehaviors($(response.selector), settings);
    $(response.selector).remove();
  },

  /**
   * Command to mark a chunk changed.
   */
  changed: function (ajax, response, status) {
    if (!$(response.selector).hasClass('ajax-changed')) {
      $(response.selector).addClass('ajax-changed');
      if (response.asterisk) {
        $(response.selector).find(response.asterisk).append(' <span class="ajax-changed">*</span> ');
      }
    }
  },

  /**
   * Command to provide an alert.
   */
  alert: function (ajax, response, status) {
    alert(response.text, response.title);
  },

  /**
   * Command to provide the jQuery css() function.
   */
  css: function (ajax, response, status) {
    $(response.selector).css(response.argument);
  },

  /**
   * Command to set the settings that will be used for other commands in this response.
   */
  settings: function (ajax, response, status) {
    if (response.merge) {
      $.extend(true, Drupal.settings, response.settings);
    }
    else {
      ajax.settings = response.settings;
    }
  },

  /**
   * Command to attach data using jQuery's data API.
   */
  data: function (ajax, response, status) {
    $(response.selector).data(response.name, response.value);
  },

  /**
   * Command to apply a jQuery method.
   */
  invoke: function (ajax, response, status) {
    var $element = $(response.selector);
    $element[response.method].apply($element, response.arguments);
  },

  /**
   * Command to restripe a table.
   */
  restripe: function (ajax, response, status) {
    // :even and :odd are reversed because jQuery counts from 0 and
    // we count from 1, so we're out of sync.
    // Match immediate children of the parent element to allow nesting.
    $('> tbody > tr:visible, > tr:visible', $(response.selector))
      .removeClass('odd even')
      .filter(':even').addClass('odd').end()
      .filter(':odd').addClass('even');
  },

  /**
   * Command to add css.
   *
   * Uses the proprietary addImport method if available as browsers which
   * support that method ignore @import statements in dynamically added
   * stylesheets.
   */
  add_css: function (ajax, response, status) {
    // Add the styles in the normal way.
    $('head').prepend(response.data);
    // Add imports in the styles using the addImport method if available.
    var match, importMatch = /^@import url\("(.*)"\);$/igm;
    if (document.styleSheets[0].addImport && importMatch.test(response.data)) {
      importMatch.lastIndex = 0;
      while (match = importMatch.exec(response.data)) {
        document.styleSheets[0].addImport(match[1]);
      }
    }
  },

  /**
   * Command to update a form's build ID.
   */
  updateBuildId: function(ajax, response, status) {
    $('input[name="form_build_id"][value="' + response['old'] + '"]').val(response['new']);
  }
};

})(jQuery);
;
/**
 * @file Require AMD definitions used by Bolero
 */
//# Require.js AMD Module Definitions
//##Foundation
IGA.module_define("foundation", ["foundation/foundation.min"], function(){ return typeof Foundation !== "undefined"; });
IGA.module_define("foundation.accordion", ["foundation/foundation.accordion.min"], ["foundation"], function(){ return typeof Foundation !== "undefined" && Foundation.libs.accordion; });
IGA.module_define("foundation.clearing", ["foundation/foundation.clearing.min", "css!foundation/foundation.clearing.css"], ["foundation"],
    function(){ return typeof Foundation !== "undefined" && Foundation.libs.clearing; });
IGA.module_define("foundation.reveal", ["foundation/foundation.reveal.min"], ["foundation"], function(){ return typeof Foundation !== "undefined" && Foundation.libs.reveal; });

require.config({
	paths:{
		"GoogleMaps" : "//maps.google.com/maps/api/js?sensor=false"
	}
});
;
/**
 * @file Require AMD definitions used by Bolero Emcee
 */
//## Medium Editor
require.config({
	paths: {
		"load-image": "jquery/blueimp/load-image/load-image",
		"load-image-exif": "jquery/blueimp/load-image/load-image-exif",
		"load-image-meta": "jquery/blueimp/load-image/load-image-meta",
		"load-image-ios": "jquery/blueimp/load-image/load-image-ios",
		"canvas-to-blob": "jquery/blueimp/canvas-to-blob/canvas-to-blob",
		"handlebars": "handlebars/handlebars.min",
		"jquery.ui.widget": "jquery/ui/jquery-ui.widget"
	}
});

//TODO move from medium/ to /
define("medium-editor", ["medium/medium-editor/js/medium-editor.min",
	"css!medium/medium-editor/css/medium-editor.min.css",
	"css!medium/medium-editor/css/themes/default.min.css"],
	function(MediumEditor){ return MediumEditor; });

define("window.Handlebars", ["handlebars"], {
	load: function(name, req, onload, config){
		require(["handlebars"], function(Handlebars){
			window.Handlebars = Handlebars;
			req([name], function (mod) {
				onload(mod);
			});
		});
	}
});

define("medium-editor-insert-plugin", ["jquery.ui.widget",
	"window.Handlebars!medium/medium-editor-insert-plugin/js/medium-editor-insert-plugin.min",
	"css!medium/medium-editor-insert-plugin/css/medium-editor-insert-plugin.min.css"],
	function(){ return MediumInsert; });;
/*globals require, requirejs, define, jQuery, Drupal, IGA, aeJS */
/**
 * @file iga_common.user.js
 */

define("IGA.user-data", ["jquery"], {
	load: function(name, req, onload, config){
		"use strict";
		var user = sessionStorage.getItem("IGA.user");
		if(jQuery.cookie && !jQuery.cookie("umg_user_uid")){
			if(user){
				user = null;
				sessionStorage.removeItem("IGA.user");
			}
			return onload(null);
		}
		if(user){
			user = JSON.parse(user);
			onload(user);
		}else{
			// GET the user from the site.
			jQuery.ajax("/api/iga/user", {
				cache: false
			}).done(function(data){
				if(!data.user || !data.user.uid){ user = {}; }
				else{ user = data.user; }
				sessionStorage.setItem("IGA.user", JSON.stringify(user));
				onload(user);
			});
		}
	}
});

define("IGA.user", ["jquery", "underscore", "IGA.events", "IGA.user-data!", "IGA.webshim.storage"],
	function($ ,_, events, user){
	"use strict";
	var User = {
		init: function(){
			if(typeof user === "object"){
				_.extend(this, user);
			}else{
				User.anonymous = true;
			}
		},
		update: function(user){
			IGA.user = _.extend(IGA.user, user);
			sessionStorage.setItem("IGA.user", JSON.stringify(user));
		},
		onLogin: function(user, options){
			if(typeof user === "object"){
				_.extend(User, user);
				var last_user = localStorage.getItem("last_user");
				if(last_user && last_user !== user.uid){
					// If a different user has logged in we should clear the browser storage.
					events.trigger("user.clear");
					localStorage.clear();
					sessionStorage.clear();
				}
				sessionStorage.setItem("IGA.user", JSON.stringify(User));
				//TODO should we set the cookie client-side?
				localStorage.setItem("last_user", user.uid);
				if(user.uid){
					var uid = user.uid;
					if(user.ae_user){ uid = user.ae_user.data.ID;}
				}
			}else{
				require(["googleanalytics"], function(){
					ga("send", "exception", {
						appName: "IGA.user",
						exDescription: "Missing user data onLogin",
						exFatal: true
					});
				});
			}
		},
		onAEUser: function(ae_user){
			var last_ae_user = localStorage.getItem("last_ae_user");
			if(last_ae_user != ae_user.data.ID){
				if(last_ae_user && !User.uid){
					localStorage.clear();
					sessionStorage.clear();
				}
				localStorage.setItem("last_ae_user", ae_user.data.ID);
			}
			if(!sessionStorage.getItem("country")){
				var country = ae_user.data.CountryCode || ae_user.data.GeoCountry;
				if (country) {
					events.trigger("country.detect", [country, "AE"]);
				}
			}
		},
		onLogout: function(user, options){
			events.trigger("user.clear");
			localStorage.clear();
			sessionStorage.clear();
		},
		onAEReady: function(){
			if(typeof aeJS !== "undefined" && aeJS.user){

			}
		}
	};
	User.init();
	events.on("user.update", User.update);
	events.on("login", User.onLogin);
	events.on("logout", User.onLogout);
	events.on("ae_user", User.onAEUser).replay("ae_user", User.onAEUser);
	events.on("ae_login", User.onAEUser).replay("ae_login", User.onAEUser);
	//events.on("ae_ready", _.bind(User.onAEReady, User)).replay("ae_ready", _.bind(User.onAEReady, User));
	var IGA = window.IGA = window.IGA || {};
	IGA.user = _.extend(IGA.user || {}, User);
	return User;
});

define("_AE.user", {
	load: function(name, req, onload, config){
		function ae_user(){
			onload(aeJS.user);
		}
		req(["IGA.events"], function(events){
			events.on("ae_ready", ae_user).replay("ae_ready", ae_user);
		});
	}
});
define("AE.user", ["_AE.user!"], function(user){ return user; });
;
/*globals require, requirejs, define, jQuery, Drupal, IGA, aeJS */
/**
 * @file iga_common.js
 */
var IGA = IGA || {}, UMG = UMG || {};
(function($, IGA){
	"use strict";
	//## IGA Login
	IGA.drupal = {
		login: function(){
			var path = window.location.pathname;
			if(path.charAt(0) === "/" && path.length > 1){
				path = path.substr(1);
			}
			window.location = "/user/login?destination="+path;
		}
	};

	IGA.login = function(){
		if(Drupal.settings.janrainCapture){
			require(["IGA.janrain"], function(){
				IGA.janrain.login.apply(this, arguments);
			});
		}else{
			IGA.drupal.login.apply(this, arguments);
		}
	};
	IGA.logout = function(){
		require(["IGA.events"], function(events){
			events.trigger("logout");
			var dest = "";
			if(window.location.pathname.length > 1){
				dest = "?destination=" + encodeURIComponent(window.location.pathname.substr(1));
			}
			window.location.href= "/user/logout" + dest;
		});
	};

	//#Update body loggedIn css classes
	IGA.login.updateCss = function(state){
		if(state === "login"){
			$("body").removeClass("not-logged-in").addClass("logged-in");
		}else if(state === "logout"){
			$("body").removeClass("logged-in").addClass("not-logged-in");
		}
	};

	//# Check roles for authenticated Drupal user & refresh the page.
	IGA.login.updateUser = function(user){
		if(user.roles){
			for(var r in user.roles){
				if(["administrator", "site maintainer", "content editor", "content contributor"].indexOf(roles[r]) >= 0){
					//If the user has a role that needs Drupal administrative features then refresh the page to load the Drupal UI.
					IGA.location.reload();
					break;
				}
			}
		}
	};

	IGA.location = {
		preventReload: {reload: false},
		reload: function(url){
			require(["IGA.events"], function(events){
				function reload(prevent){
					if(!prevent.reload){
						prevent.reload = false;
						if(url){
							location.href = url;
						}else{
							location.reload();
						}
						return true;
					}
				}

				events.off("location.reload", reload);
				// EventEmitter uses a FILO queue, and we want to add the final listener.
				var listeners = events.getListeners("location.reload");
				listeners.splice(0,0, { listener: reload, once:false });
				events.trigger("location.reload", [IGA.location.preventReload, url]);
			});
		}
	};

	IGA.timingStart = IGA.timingStart || Date.now();

	Drupal.behaviors.iga_common = {
		attach: function(context, settings){
			$('a[href="/user/logout"]', context).once("iga-common", function(){
				$(this).on("click", function(e) {
					e.preventDefault();
					e.stopImmediatePropagation();
					IGA.logout();
				});
			});
		}
	};

	IGA.conversionPt = IGA.conversionPt || "unknown";
	var dsae = Drupal.settings.ae_social_login, isMobile = false;
	if(dsae && dsae.settings){
		isMobile = !dsae.settings.auth_window;
		require(["IGA.events"], function(events){
			events.on("ae_mobile_detect", function(){ isMobile = true; });
		});
	}
	IGA.setConversion = function(cp, authenticate){
		IGA.conversionPt = cp;
		if(isMobile && authenticate){
			// A direct social authentication may cause a redirect so we need to save the conversion point.
			localStorage.setItem("IGA.conversionPt", cp);
		}
	};

	// jQuery deprecated polyfill
	try{
		var $version = parseFloat($.fn.jquery);
		if( $version === 1.7 ){
			$.parseHTML = function(html){
				return $("<span>"+html+"</span>").html();
			};
		}
	}catch(e){}

})(jQuery, IGA);

//## Google Analytics UA shim module
define("googleanalytics", [], function(){
    "use strict";
    var defined = typeof window.ga !== "undefined";
    if(defined && window.ga.loaded){
        return window.ga;
    } else if(defined){
        return function () { window.ga.apply(this, arguments); };
    }else{
        window.ga = function(){}; return window.ga;
    }
});
//## GTM shim
define("gtm", [], function(){
    "use strict";
	if(typeof window.dataLayer === "undefined"){ window.dataLayer = []; }
});

//## IGA Common Analytics
define("IGA.analytics.common",["jquery", "IGA.user", "IGA.events", "googleanalytics", "gtm", "IGA.webshim.storage"], function($, user, events){
	"use strict";
	//Centrally track the last known conversion point
	IGA.conversionPt = IGA.conversionPt || "unknown";
	if(localStorage.getItem("IGA.conversionPt")){
		IGA.conversionPt = localStorage.getItem("IGA.conversionPt");
		localStorage.removeItem("IGA.conversionPt");
	}

	//### Login Analytics Tracking
	IGA.events.on("login", function(user, data){
		data = data || {};
		var ni = (IGA.conversionPt === "SSO"),
			ga_data = { nonInteraction: ni };
		if(data.ae_user && data.ae_user.data){
			// Set the userId as the AE userID
			ga("set", "userId", data.ae_user.data.ID);
			// dimension1 = Drupal user, 2 = AE user
			ga_data.dimension1 = user.uid;
			ga_data.dimension2 = data.ae_user.data.ID ;
			dataLayer.push({ userID: user.uid, socialID: data.ae_user.data.ID });
		}
		if(data.provider){ ga_data.dimension3 = data.provider; }
		if(data.display){ ga_data.dimension4 = data.display; }
		ga("send", "event", "Conversion", "login", IGA.conversionPt, null, ga_data);
		if(user.new){
			ga("send", "event", "Conversion", "registration", IGA.conversionPt, null);
		}
		IGA.conversionPt = "unknown";
		localStorage.removeItem("IGA.conversionPt");
	});

	function ae_ready(aeJS){
		ga('send', 'timing', 'Appreciation Engine', 'aeJSReady', Date.now() - IGA.timingStart, 'AE');
	}

	function ae_user(ae_user, type){
		if(type === "init" && !user.uid && $.cookie){
			var ae_uid = $.cookie("umg_ae_user_uid");
			if(!ae_uid){
				$.cookie("umg_ae_user_uid", ae_user.data.ID, { path: '/' });
				ga("set", { "dimension2": ae_user.data.ID });
				ga("set", "userId", ae_user.data.ID);
			}
		}
	}

	events.on("ae_ready", ae_ready).replay("ae_ready", ae_ready);
	events.on("ae_user", ae_user).replay("ae_user", ae_user);

	//### Log JS errors in GA
	window.onerror = function iga_error(message, url, line, col, e) {
		if(typeof message !== "string" || typeof url !== "string" ){ return; }
		var exDescription = (e && e.stack) ? e.stack : (message + " :: " + url + " :: line " + line);
		ga("send", "exception", {
			appName: "Uncaught JavaScript Error",
			exDescription: exDescription,
			exFatal: true
		});
		return false;
	};

	return true;
});

//## IGA.Events
define("IGA.events", ["inherits", "EventEmitter.history", "EventEmitter.namespace", "eventie"],
	function(inherits, HistoryEmitter, NamespaceEmitter){
	"use strict";
	function IGAEvents(){
		HistoryEmitter.apply(this, arguments);
	}
	inherits(IGAEvents, HistoryEmitter);
	NamespaceEmitter.inherit(IGAEvents);

	IGA.events = new IGAEvents();
	return IGA.events;
});

//## IGA Common Main Require
require(["IGA.user", "IGA.events", "IGA.analytics.common"], function(user, events){
	"use strict";
	events.on("login", function(user, data){
		data = data || {};
		if(!data.redirect && data.ajax){
			IGA.login.updateUser(user);
		}
	});

	events.on("logout", function(){
		if(Drupal.behaviors.ae_social_login && !Drupal.behaviors.ae_social_login.override_logout){
			if(typeof aeJS !== "undefined"){
				aeJS.trigger.logout();
			}else{
				events.on("ae_ready", function(aeJS){ aeJS.trigger.logout(); });
			}
		}
	});

	//### Zendesk User
	function zendesk_id(){
		if(typeof zE !== "undefined" && user.uid){
			zE(function() {
				zE.identify({
					name: user.field_display_name,
					email: user.mail,
					externalId: user.uid
				});
			});
		}
	}
	setTimeout(zendesk_id, 0);

	// ### Country Geo-Detection
	if (UMG.IPCountry) {
		events.trigger("country", [UMG.IPCountry, "IP"]);
	} else {
		window.addEventListener('UMG.IPCountry', function (e) {
      if (e.detail && e.detail.country) {
        events.trigger("country", [e.detail.country, "IP"]);
      }
		}, false);
	}
	function setCountry(country, source) {
		UMG.country = country;
		if (source === "IP") {
			UMG.geoCountry = country;
		}
	}
	events.on("country", setCountry).replay("country", setCountry);

	// ### CASL / non-US Opt-in required by default
	require(["underscore", "IGA.webshim.storage"], function(_){
		// #### If the user must explicitly opt-in to lists
		var optout_default = UMG.optout_default ||  sessionStorage.getItem("optout_default");
		function set_optout(reason){
			require(["googleanalytics"], function(){
				if(!optout_default || optout_default !== reason){
					ga("send", "event", "Miscellaneous", "optout.default", reason, null, { nonInteraction:1 });
					// remember that throughout their session.
					sessionStorage.setItem("optout_default", reason);
					optout_default = reason;
				}
			});
		}
		//TODO set_optin() to re optin if user changes country back to US?

		// #### If the user's country is detected

		var country_detect = _.debounce(function (country){
			if(!sessionStorage.getItem("country")){
				// and it isn't set already then set it.
				sessionStorage.setItem("country", country);
			}
			if(country){ country = country.toUpperCase(); }
			// Then check if the user needs to opt-in to lists manually (all non-US countries).
			if(country === "CA" || country === "CANADA"){
				events.trigger("optout.default", ["casl"]);
			}else if(country && country !== "US" && country !== "UNITED STATES"){
				events.trigger("optout.default", ["nonUS"]);
			} else if (country === "US" || country === "UNITED STATES"){
				sessionStorage.removeItem("optout_default");
				optout_default = null;
			}
		});

		// #### If the user manually selects a country
		function country_set(country){
			sessionStorage.setItem("country", country);
			if (country === "US"){
				// and the country is US remove the opt-in requirement.
				sessionStorage.removeItem("optout_default");
				optout_default = null;
			}
		}

		if(optout_default){
			events.trigger("optout.default", [optout_default]);
		}else{
			events.on("optout.default", set_optout).replay("optout.default", set_optout);
		}
		events.on("country", country_detect).replay("country", country_detect);
		events.on("country.manual", country_set);
	});
});

//## Drupal Core JS Module Definitions
(function(){
	"use strict";
	var base_url = location.protocol+"//"+location.host;
	IGA.module_define("Drupal.ajax", [base_url+"/misc/ajax.js"], function(){ return Drupal.ajax; });
})();
;
!function(t,e,i,n){"use strict";function a(t){return("string"==typeof t||t instanceof String)&&(t=t.replace(/^['\\/"]+|(;\s?})+|['\\/"]+$/g,"")),t}var s=function(e){for(var i=e.length,n=t("head");i--;)0===n.has("."+e[i]).length&&n.append('<meta class="'+e[i]+'" />')};s(["foundation-mq-small","foundation-mq-small-only","foundation-mq-medium","foundation-mq-medium-only","foundation-mq-large","foundation-mq-large-only","foundation-mq-xlarge","foundation-mq-xlarge-only","foundation-mq-xxlarge","foundation-data-attribute-namespace"]),t(function(){"undefined"!=typeof FastClick&&"undefined"!=typeof i.body&&FastClick.attach(i.body)});var r=function(e,n){if("string"==typeof e){if(n){var a;if(n.jquery){if(a=n[0],!a)return n}else a=n;return t(a.querySelectorAll(e))}return t(i.querySelectorAll(e))}return t(e,n)},o=function(t){var e=[];return t||e.push("data"),this.namespace.length>0&&e.push(this.namespace),e.push(this.name),e.join("-")},u=function(t){for(var e=t.split("-"),i=e.length,n=[];i--;)0!==i?n.push(e[i]):this.namespace.length>0?n.push(this.namespace,e[i]):n.push(e[i]);return n.reverse().join("-")},l=function(e,i){var n=this,a=function(){var a=r(this),s=!a.data(n.attr_name(!0)+"-init");a.data(n.attr_name(!0)+"-init",t.extend({},n.settings,i||e,n.data_options(a))),s&&n.events(this)};return r(this.scope).is("["+this.attr_name()+"]")?a.call(this.scope):r("["+this.attr_name()+"]",this.scope).each(a),"string"==typeof e?this[e].call(this,i):void 0},m=function(t,e){function i(){e(t[0])}function n(){if(this.one("load",i),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var t=this.attr("src"),e=t.match(/\?/)?"&":"?";e+="random="+(new Date).getTime(),this.attr("src",t+e)}}return t.attr("src")?void(t[0].complete||4===t[0].readyState?i():n.call(t)):void i()};e.matchMedia||(e.matchMedia=function(){var t=e.styleMedia||e.media;if(!t){var n=i.createElement("style"),a=i.getElementsByTagName("script")[0],s=null;n.type="text/css",n.id="matchmediajs-test",a.parentNode.insertBefore(n,a),s="getComputedStyle"in e&&e.getComputedStyle(n,null)||n.currentStyle,t={matchMedium:function(t){var e="@media "+t+"{ #matchmediajs-test { width: 1px; } }";return n.styleSheet?n.styleSheet.cssText=e:n.textContent=e,"1px"===s.width}}}return function(e){return{matches:t.matchMedium(e||"all"),media:e||"all"}}}()),function(t){function i(){n&&(r(i),u&&t.fx.tick())}for(var n,a=0,s=["webkit","moz"],r=e.requestAnimationFrame,o=e.cancelAnimationFrame,u="undefined"!=typeof t.fx;a<s.length&&!r;a++)r=e[s[a]+"RequestAnimationFrame"],o=o||e[s[a]+"CancelAnimationFrame"]||e[s[a]+"CancelRequestAnimationFrame"];r?(e.requestAnimationFrame=r,e.cancelAnimationFrame=o,u&&(t.fx.timer=function(e){e()&&t.timers.push(e)&&!n&&(n=!0,i())},t.fx.stop=function(){n=!1})):(e.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-a)),s=e.setTimeout(function(){t(i+n)},n);return a=i+n,s},e.cancelAnimationFrame=function(t){clearTimeout(t)})}(t),e.Foundation={name:"Foundation",version:"5.5.2",media_queries:{small:r(".foundation-mq-small").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"small-only":r(".foundation-mq-small-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),medium:r(".foundation-mq-medium").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"medium-only":r(".foundation-mq-medium-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),large:r(".foundation-mq-large").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"large-only":r(".foundation-mq-large-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),xlarge:r(".foundation-mq-xlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"xlarge-only":r(".foundation-mq-xlarge-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),xxlarge:r(".foundation-mq-xxlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,"")},stylesheet:t("<style></style>").appendTo("head")[0].sheet,global:{namespace:n},init:function(t,i,n,a,s){var o=[t,n,a,s],u=[];if(this.rtl=/rtl/i.test(r("html").attr("dir")),this.scope=t||this.scope,this.set_namespace(),i&&"string"==typeof i&&!/reflow/i.test(i))this.libs.hasOwnProperty(i)&&u.push(this.init_lib(i,o));else for(var l in this.libs)u.push(this.init_lib(l,i));return r(e).load(function(){r(e).trigger("resize.fndtn.clearing").trigger("resize.fndtn.dropdown").trigger("resize.fndtn.equalizer").trigger("resize.fndtn.interchange").trigger("resize.fndtn.joyride").trigger("resize.fndtn.magellan").trigger("resize.fndtn.topbar").trigger("resize.fndtn.slider")}),t},init_lib:function(e,i){return this.libs.hasOwnProperty(e)?(this.patch(this.libs[e]),i&&i.hasOwnProperty(e)?("undefined"!=typeof this.libs[e].settings?t.extend(!0,this.libs[e].settings,i[e]):"undefined"!=typeof this.libs[e].defaults&&t.extend(!0,this.libs[e].defaults,i[e]),this.libs[e].init.apply(this.libs[e],[this.scope,i[e]])):(i=i instanceof Array?i:new Array(i),this.libs[e].init.apply(this.libs[e],i))):function(){}},patch:function(t){t.scope=this.scope,t.namespace=this.global.namespace,t.rtl=this.rtl,t.data_options=this.utils.data_options,t.attr_name=o,t.add_namespace=u,t.bindings=l,t.S=this.utils.S},inherit:function(t,e){for(var i=e.split(" "),n=i.length;n--;)this.utils.hasOwnProperty(i[n])&&(t[i[n]]=this.utils[i[n]])},set_namespace:function(){var e=this.global.namespace===n?t(".foundation-data-attribute-namespace").css("font-family"):this.global.namespace;this.global.namespace=e===n||/false/i.test(e)?"":e},libs:{},utils:{S:r,throttle:function(t,e){var i=null;return function(){var n=this,a=arguments;null==i&&(i=setTimeout(function(){t.apply(n,a),i=null},e))}},debounce:function(t,e,i){var n,a;return function(){var s=this,r=arguments,o=function(){n=null,i||(a=t.apply(s,r))},u=i&&!n;return clearTimeout(n),n=setTimeout(o,e),u&&(a=t.apply(s,r)),a}},data_options:function(e,i){function n(t){return!isNaN(t-0)&&null!==t&&""!==t&&t!==!1&&t!==!0}function a(e){return"string"==typeof e?t.trim(e):e}i=i||"options";var s,r,o,u={},l=function(t){var e=Foundation.global.namespace;return t.data(e.length>0?e+"-"+i:i)},m=l(e);if("object"==typeof m)return m;for(o=(m||":").split(";"),s=o.length;s--;)r=o[s].split(":"),r=[r[0],r.slice(1).join(":")],/true/i.test(r[1])&&(r[1]=!0),/false/i.test(r[1])&&(r[1]=!1),n(r[1])&&(r[1]=-1===r[1].indexOf(".")?parseInt(r[1],10):parseFloat(r[1])),2===r.length&&r[0].length>0&&(u[a(r[0])]=a(r[1]));return u},register_media:function(e,i){Foundation.media_queries[e]===n&&(t("head").append('<meta class="'+i+'"/>'),Foundation.media_queries[e]=a(t("."+i).css("font-family")))},add_custom_rule:function(t,e){if(e===n&&Foundation.stylesheet)Foundation.stylesheet.insertRule(t,Foundation.stylesheet.cssRules.length);else{var i=Foundation.media_queries[e];i!==n&&Foundation.stylesheet.insertRule("@media "+Foundation.media_queries[e]+"{ "+t+" }",Foundation.stylesheet.cssRules.length)}},image_loaded:function(t,e){function i(t){for(var e=t.length,i=e-1;i>=0;i--)if(t.attr("height")===n)return!1;return!0}var a=this,s=t.length;(0===s||i(t))&&e(t),t.each(function(){m(a.S(this),function(){s-=1,0===s&&e(t)})})},random_str:function(){return this.fidx||(this.fidx=0),this.prefix=this.prefix||[this.name||"F",(+new Date).toString(36)].join("-"),this.prefix+(this.fidx++).toString(36)},match:function(t){return e.matchMedia(t).matches},is_small_up:function(){return this.match(Foundation.media_queries.small)},is_medium_up:function(){return this.match(Foundation.media_queries.medium)},is_large_up:function(){return this.match(Foundation.media_queries.large)},is_xlarge_up:function(){return this.match(Foundation.media_queries.xlarge)},is_xxlarge_up:function(){return this.match(Foundation.media_queries.xxlarge)},is_small_only:function(){return!(this.is_medium_up()||this.is_large_up()||this.is_xlarge_up()||this.is_xxlarge_up())},is_medium_only:function(){return this.is_medium_up()&&!this.is_large_up()&&!this.is_xlarge_up()&&!this.is_xxlarge_up()},is_large_only:function(){return this.is_medium_up()&&this.is_large_up()&&!this.is_xlarge_up()&&!this.is_xxlarge_up()},is_xlarge_only:function(){return this.is_medium_up()&&this.is_large_up()&&this.is_xlarge_up()&&!this.is_xxlarge_up()},is_xxlarge_only:function(){return this.is_medium_up()&&this.is_large_up()&&this.is_xlarge_up()&&this.is_xxlarge_up()}}},t.fn.foundation=function(){var t=Array.prototype.slice.call(arguments,0);return this.each(function(){return Foundation.init.apply(Foundation,[this].concat(t)),this})}}(jQuery,window,window.document);;
!function(a){"use strict";Foundation.libs.offcanvas={name:"offcanvas",version:"5.5.2",settings:{open_method:"move",close_on_click:!1},init:function(a,e,t){this.bindings(e,t)},events:function(){var e=this,t=e.S,s="",n="",o="",c="",l="";"move"===this.settings.open_method?(s="move-",n="right",o="left",c="top",l="bottom"):"overlap_single"===this.settings.open_method?(s="offcanvas-overlap-",n="right",o="left",c="top",l="bottom"):"overlap"===this.settings.open_method&&(s="offcanvas-overlap"),t(this.scope).off(".offcanvas").on("click.fndtn.offcanvas",".left-off-canvas-toggle",function(o){e.click_toggle_class(o,s+n),"overlap"!==e.settings.open_method&&t(".left-submenu").removeClass(s+n),a(".left-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".left-off-canvas-menu a",function(o){var c=e.get_settings(o),l=t(this).parent();!c.close_on_click||l.hasClass("has-submenu")||l.hasClass("back")?t(this).parent().hasClass("has-submenu")?(o.preventDefault(),t(this).siblings(".left-submenu").toggleClass(s+n)):l.hasClass("back")&&(o.preventDefault(),l.parent().removeClass(s+n)):(e.hide.call(e,s+n,e.get_wrapper(o)),l.parent().removeClass(s+n)),a(".left-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".right-off-canvas-toggle",function(n){e.click_toggle_class(n,s+o),"overlap"!==e.settings.open_method&&t(".right-submenu").removeClass(s+o),a(".right-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".right-off-canvas-menu a",function(n){var c=e.get_settings(n),l=t(this).parent();!c.close_on_click||l.hasClass("has-submenu")||l.hasClass("back")?t(this).parent().hasClass("has-submenu")?(n.preventDefault(),t(this).siblings(".right-submenu").toggleClass(s+o)):l.hasClass("back")&&(n.preventDefault(),l.parent().removeClass(s+o)):(e.hide.call(e,s+o,e.get_wrapper(n)),l.parent().removeClass(s+o)),a(".right-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".top-off-canvas-toggle",function(n){e.click_toggle_class(n,s+l),"overlap"!==e.settings.open_method&&t(".top-submenu").removeClass(s+l),a(".top-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".top-off-canvas-menu a",function(n){var o=e.get_settings(n),c=t(this).parent();!o.close_on_click||c.hasClass("has-submenu")||c.hasClass("back")?t(this).parent().hasClass("has-submenu")?(n.preventDefault(),t(this).siblings(".top-submenu").toggleClass(s+l)):c.hasClass("back")&&(n.preventDefault(),c.parent().removeClass(s+l)):(e.hide.call(e,s+l,e.get_wrapper(n)),c.parent().removeClass(s+l)),a(".top-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".bottom-off-canvas-toggle",function(n){e.click_toggle_class(n,s+c),"overlap"!==e.settings.open_method&&t(".bottom-submenu").removeClass(s+c),a(".bottom-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".bottom-off-canvas-menu a",function(n){var o=e.get_settings(n),l=t(this).parent();!o.close_on_click||l.hasClass("has-submenu")||l.hasClass("back")?t(this).parent().hasClass("has-submenu")?(n.preventDefault(),t(this).siblings(".bottom-submenu").toggleClass(s+c)):l.hasClass("back")&&(n.preventDefault(),l.parent().removeClass(s+c)):(e.hide.call(e,s+c,e.get_wrapper(n)),l.parent().removeClass(s+c)),a(".bottom-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".exit-off-canvas",function(c){e.click_remove_class(c,s+o),t(".right-submenu").removeClass(s+o),n&&(e.click_remove_class(c,s+n),t(".left-submenu").removeClass(s+o)),a(".right-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".exit-off-canvas",function(t){e.click_remove_class(t,s+o),a(".left-off-canvas-toggle").attr("aria-expanded","false"),n&&(e.click_remove_class(t,s+n),a(".right-off-canvas-toggle").attr("aria-expanded","false"))}).on("click.fndtn.offcanvas",".exit-off-canvas",function(n){e.click_remove_class(n,s+c),t(".bottom-submenu").removeClass(s+c),l&&(e.click_remove_class(n,s+l),t(".top-submenu").removeClass(s+c)),a(".bottom-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".exit-off-canvas",function(t){e.click_remove_class(t,s+c),a(".top-off-canvas-toggle").attr("aria-expanded","false"),l&&(e.click_remove_class(t,s+l),a(".bottom-off-canvas-toggle").attr("aria-expanded","false"))})},toggle:function(a,e){e=e||this.get_wrapper(),e.is("."+a)?this.hide(a,e):this.show(a,e)},show:function(a,e){e=e||this.get_wrapper(),e.trigger("open.fndtn.offcanvas"),e.addClass(a)},hide:function(a,e){e=e||this.get_wrapper(),e.trigger("close.fndtn.offcanvas"),e.removeClass(a)},click_toggle_class:function(a,e){a.preventDefault();var t=this.get_wrapper(a);this.toggle(e,t)},click_remove_class:function(a,e){a.preventDefault();var t=this.get_wrapper(a);this.hide(e,t)},get_settings:function(a){var e=this.S(a.target).closest("["+this.attr_name()+"]");return e.data(this.attr_name(!0)+"-init")||this.settings},get_wrapper:function(a){var e=this.S(a?a.target:this.scope).closest(".off-canvas-wrap");return 0===e.length&&(e=this.S(".off-canvas-wrap")),e},reflow:function(){}}}(jQuery,window,window.document);;
!function(e,t,n,a){"use strict";function o(e){var t=/fade/i.test(e),n=/pop/i.test(e);return{animate:t||n,pop:n,fade:t}}var s=[];Foundation.libs.reveal={name:"reveal",version:"5.5.2",locked:!1,settings:{animation:"fadeAndPop",animation_speed:250,close_on_background_click:!0,close_on_esc:!0,dismiss_modal_class:"close-reveal-modal",multiple_opened:!1,bg_class:"reveal-modal-bg",root_element:"body",open:function(){},opened:function(){},close:function(){},closed:function(){},on_ajax_error:e.noop,bg:e(".reveal-modal-bg"),css:{open:{opacity:0,visibility:"visible",display:"block"},close:{opacity:1,visibility:"hidden",display:"none"}}},init:function(t,n,a){e.extend(!0,this.settings,n,a),this.bindings(n,a)},events:function(){var e=this,t=e.S;return t(this.scope).off(".reveal").on("click.fndtn.reveal","["+this.add_namespace("data-reveal-id")+"]:not([disabled])",function(n){if(n.preventDefault(),!e.locked){var a=t(this),o=a.data(e.data_attr("reveal-ajax")),s=a.data(e.data_attr("reveal-replace-content"));if(e.locked=!0,"undefined"==typeof o)e.open.call(e,a);else{var i=o===!0?a.attr("href"):o;e.open.call(e,a,{url:i},{replaceContentSel:s})}}}),t(n).on("click.fndtn.reveal",this.close_targets(),function(n){if(n.preventDefault(),!e.locked){var a=t("["+e.attr_name()+"].open").data(e.attr_name(!0)+"-init")||e.settings,o=t(n.target)[0]===t("."+a.bg_class)[0];if(o){if(!a.close_on_background_click)return;n.stopPropagation()}e.locked=!0,e.close.call(e,o?t("["+e.attr_name()+"].open:not(.toback)"):t(this).closest("["+e.attr_name()+"]"))}}),t("["+e.attr_name()+"]",this.scope).length>0?t(this.scope).on("open.fndtn.reveal",this.settings.open).on("opened.fndtn.reveal",this.settings.opened).on("opened.fndtn.reveal",this.open_video).on("close.fndtn.reveal",this.settings.close).on("closed.fndtn.reveal",this.settings.closed).on("closed.fndtn.reveal",this.close_video):t(this.scope).on("open.fndtn.reveal","["+e.attr_name()+"]",this.settings.open).on("opened.fndtn.reveal","["+e.attr_name()+"]",this.settings.opened).on("opened.fndtn.reveal","["+e.attr_name()+"]",this.open_video).on("close.fndtn.reveal","["+e.attr_name()+"]",this.settings.close).on("closed.fndtn.reveal","["+e.attr_name()+"]",this.settings.closed).on("closed.fndtn.reveal","["+e.attr_name()+"]",this.close_video),!0},key_up_on:function(){var e=this;return e.S("body").off("keyup.fndtn.reveal").on("keyup.fndtn.reveal",function(t){var n=e.S("["+e.attr_name()+"].open"),a=n.data(e.attr_name(!0)+"-init")||e.settings;a&&27===t.which&&a.close_on_esc&&!e.locked&&e.close.call(e,n)}),!0},key_up_off:function(){return this.S("body").off("keyup.fndtn.reveal"),!0},open:function(n,o){var i,r=this;n?"undefined"!=typeof n.selector?i=r.S("#"+n.data(r.data_attr("reveal-id"))).first():(i=r.S(this.scope),o=n):i=r.S(this.scope);var d=i.data(r.attr_name(!0)+"-init");if(d=d||this.settings,i.hasClass("open")&&n!==a&&n.attr("data-reveal-id")==i.attr("id"))return r.close(i);if(!i.hasClass("open")){var l=r.S("["+r.attr_name()+"].open");"undefined"==typeof i.data("css-top")&&i.data("css-top",parseInt(i.css("top"),10)).data("offset",this.cache_offset(i)),i.attr("tabindex","0").attr("aria-hidden","false"),this.key_up_on(i),i.on("open.fndtn.reveal",function(e){"fndtn.reveal"!==e.namespace}),i.on("open.fndtn.reveal").trigger("open.fndtn.reveal"),l.length<1&&this.toggle_bg(i,!0),"string"==typeof o&&(o={url:o});var c=function(){l.length>0&&(d.multiple_opened?r.to_back(l):r.hide(l,d.css.close)),d.multiple_opened&&s.push(i),r.show(i,d.css.open)};if("undefined"!=typeof o&&o.url){var f="undefined"!=typeof o.success?o.success:null;e.extend(o,{success:function(t,n,a){if(e.isFunction(f)){var o=f(t,n,a);"string"==typeof o&&(t=o)}"undefined"!=typeof options&&"undefined"!=typeof options.replaceContentSel?i.find(options.replaceContentSel).html(t):i.html(t),r.S(i).foundation("section","reflow"),r.S(i).children().foundation(),c()}}),d.on_ajax_error!==e.noop&&e.extend(o,{error:d.on_ajax_error}),e.ajax(o)}else c()}r.S(t).trigger("resize")},close:function(t){var t=t&&t.length?t:this.S(this.scope),n=this.S("["+this.attr_name()+"].open"),a=t.data(this.attr_name(!0)+"-init")||this.settings,o=this;if(n.length>0)if(t.removeAttr("tabindex","0").attr("aria-hidden","true"),this.locked=!0,this.key_up_off(t),t.trigger("close.fndtn.reveal"),(a.multiple_opened&&1===n.length||!a.multiple_opened||t.length>1)&&(o.toggle_bg(t,!1),o.to_front(t)),a.multiple_opened){var i=t.is(":not(.toback)");o.hide(t,a.css.close,a),i?s.pop():s=e.grep(s,function(e){var n=e[0]===t[0];return n&&o.to_front(t),!n}),s.length>0&&o.to_front(s[s.length-1])}else o.hide(n,a.css.close,a)},close_targets:function(){var e="."+this.settings.dismiss_modal_class;return this.settings.close_on_background_click?e+", ."+this.settings.bg_class:e},toggle_bg:function(t,n){0===this.S("."+this.settings.bg_class).length&&(this.settings.bg=e("<div />",{"class":this.settings.bg_class}).appendTo("body").hide());var o=this.settings.bg.filter(":visible").length>0;n!=o&&((n==a?o:!n)?this.hide(this.settings.bg):this.show(this.settings.bg))},show:function(n,a){if(a){var s=n.data(this.attr_name(!0)+"-init")||this.settings,i=s.root_element,r=this;if(0===n.parent(i).length){var d=n.wrap('<div style="display: none;" />').parent();n.on("closed.fndtn.reveal.wrapped",function(){n.detach().appendTo(d),n.unwrap().unbind("closed.fndtn.reveal.wrapped")}),n.detach().appendTo(i)}var l=o(s.animation);if(l.animate||(this.locked=!1),l.pop){a.top=e(t).scrollTop()-n.data("offset")+"px";var c={top:e(t).scrollTop()+n.data("css-top")+"px",opacity:1};return setTimeout(function(){return n.css(a).animate(c,s.animation_speed,"linear",function(){r.locked=!1,n.trigger("opened.fndtn.reveal")}).addClass("open")},s.animation_speed/2)}if(l.fade){a.top=e(t).scrollTop()+n.data("css-top")+"px";var c={opacity:1};return setTimeout(function(){return n.css(a).animate(c,s.animation_speed,"linear",function(){r.locked=!1,n.trigger("opened.fndtn.reveal")}).addClass("open")},s.animation_speed/2)}return n.css(a).show().css({opacity:1}).addClass("open").trigger("opened.fndtn.reveal")}var s=this.settings;return o(s.animation).fade?n.fadeIn(s.animation_speed/2):(this.locked=!1,n.show())},to_back:function(e){e.addClass("toback")},to_front:function(e){e.removeClass("toback")},hide:function(n,a){if(a){var s=n.data(this.attr_name(!0)+"-init"),i=this;s=s||this.settings;var r=o(s.animation);if(r.animate||(this.locked=!1),r.pop){var d={top:-e(t).scrollTop()-n.data("offset")+"px",opacity:0};return setTimeout(function(){return n.animate(d,s.animation_speed,"linear",function(){i.locked=!1,n.css(a).trigger("closed.fndtn.reveal")}).removeClass("open")},s.animation_speed/2)}if(r.fade){var d={opacity:0};return setTimeout(function(){return n.animate(d,s.animation_speed,"linear",function(){i.locked=!1,n.css(a).trigger("closed.fndtn.reveal")}).removeClass("open")},s.animation_speed/2)}return n.hide().css(a).removeClass("open").trigger("closed.fndtn.reveal")}var s=this.settings;return o(s.animation).fade?n.fadeOut(s.animation_speed/2):n.hide()},close_video:function(t){var n=e(".flex-video",t.target),a=e("iframe",n);a.length>0&&(a.attr("data-src",a[0].src),a.attr("src",a.attr("src")),n.hide())},open_video:function(t){var n=e(".flex-video",t.target),o=n.find("iframe");if(o.length>0){var s=o.attr("data-src");if("string"==typeof s)o[0].src=o.attr("data-src");else{var i=o[0].src;o[0].src=a,o[0].src=i}n.show()}},data_attr:function(e){return this.namespace.length>0?this.namespace+"-"+e:e},cache_offset:function(e){var t=e.show().height()+parseInt(e.css("top"),10)+e.scrollY;return e.hide(),t},off:function(){e(this.scope).off(".fndtn.reveal")},reflow:function(){}}}(jQuery,window,window.document);;
/*! Picturefill - v2.3.1 - 2015-06-01
* http://scottjehl.github.io/picturefill
* Copyright (c) 2015 https://github.com/scottjehl/picturefill/blob/master/Authors.txt; Licensed MIT */
window.matchMedia||(window.matchMedia=function(){"use strict";var a=window.styleMedia||window.media;if(!a){var b=document.createElement("style"),c=document.getElementsByTagName("script")[0],d=null;b.type="text/css",b.id="matchmediajs-test",c.parentNode.insertBefore(b,c),d="getComputedStyle"in window&&window.getComputedStyle(b,null)||b.currentStyle,a={matchMedium:function(a){var c="@media "+a+"{ #matchmediajs-test { width: 1px; } }";return b.styleSheet?b.styleSheet.cssText=c:b.textContent=c,"1px"===d.width}}}return function(b){return{matches:a.matchMedium(b||"all"),media:b||"all"}}}()),function(a,b,c){"use strict";function d(b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b:"function"==typeof define&&define.amd&&(define("picturefill",function(){return b}),a.picturefill=b),"object"==typeof a&&(a.picturefill=b)}function e(a){var b,c,d,e,f,i=a||{};b=i.elements||g.getAllElements();for(var j=0,k=b.length;k>j;j++)if(c=b[j],d=c.parentNode,e=void 0,f=void 0,"IMG"===c.nodeName.toUpperCase()&&(c[g.ns]||(c[g.ns]={}),i.reevaluate||!c[g.ns].evaluated)){if(d&&"PICTURE"===d.nodeName.toUpperCase()){if(g.removeVideoShim(d),e=g.getMatch(c,d),e===!1)continue}else e=void 0;(d&&"PICTURE"===d.nodeName.toUpperCase()||!g.sizesSupported&&c.srcset&&h.test(c.srcset))&&g.dodgeSrcset(c),e?(f=g.processSourceSet(e),g.applyBestCandidate(f,c)):(f=g.processSourceSet(c),(void 0===c.srcset||c[g.ns].srcset)&&g.applyBestCandidate(f,c)),c[g.ns].evaluated=!0}}function f(){function c(){clearTimeout(d),d=setTimeout(h,60)}g.initTypeDetects(),e();var d,f=setInterval(function(){return e(),/^loaded|^i|^c/.test(b.readyState)?void clearInterval(f):void 0},250),h=function(){e({reevaluate:!0})};a.addEventListener?a.addEventListener("resize",c,!1):a.attachEvent&&a.attachEvent("onresize",c)}b.createElement("picture");var g=a.picturefill||{},h=/\s+\+?\d+(e\d+)?w/;g.ns="picturefill",function(){g.srcsetSupported="srcset"in c,g.sizesSupported="sizes"in c,g.curSrcSupported="currentSrc"in c}(),g.trim=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},g.makeUrl=function(){var a=b.createElement("a");return function(b){return a.href=b,a.href}}(),g.restrictsMixedContent=function(){return"https:"===a.location.protocol},g.matchesMedia=function(b){return a.matchMedia&&a.matchMedia(b).matches},g.getDpr=function(){return a.devicePixelRatio||1},g.getWidthFromLength=function(a){var c;if(!a||a.indexOf("%")>-1!=!1||!(parseFloat(a)>0||a.indexOf("calc(")>-1))return!1;a=a.replace("vw","%"),g.lengthEl||(g.lengthEl=b.createElement("div"),g.lengthEl.style.cssText="border:0;display:block;font-size:1em;left:0;margin:0;padding:0;position:absolute;visibility:hidden",g.lengthEl.className="helper-from-picturefill-js"),g.lengthEl.style.width="0px";try{g.lengthEl.style.width=a}catch(d){}return b.body.appendChild(g.lengthEl),c=g.lengthEl.offsetWidth,0>=c&&(c=!1),b.body.removeChild(g.lengthEl),c},g.detectTypeSupport=function(b,c){var d=new a.Image;return d.onerror=function(){g.types[b]=!1,e()},d.onload=function(){g.types[b]=1===d.width,e()},d.src=c,"pending"},g.types=g.types||{},g.initTypeDetects=function(){g.types["image/jpeg"]=!0,g.types["image/gif"]=!0,g.types["image/png"]=!0,g.types["image/svg+xml"]=b.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"),g.types["image/webp"]=g.detectTypeSupport("image/webp","data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=")},g.verifyTypeSupport=function(a){var b=a.getAttribute("type");if(null===b||""===b)return!0;var c=g.types[b];return"string"==typeof c&&"pending"!==c?(g.types[b]=g.detectTypeSupport(b,c),"pending"):"function"==typeof c?(c(),"pending"):c},g.parseSize=function(a){var b=/(\([^)]+\))?\s*(.+)/g.exec(a);return{media:b&&b[1],length:b&&b[2]}},g.findWidthFromSourceSize=function(c){for(var d,e=g.trim(c).split(/\s*,\s*/),f=0,h=e.length;h>f;f++){var i=e[f],j=g.parseSize(i),k=j.length,l=j.media;if(k&&(!l||g.matchesMedia(l))&&(d=g.getWidthFromLength(k)))break}return d||Math.max(a.innerWidth||0,b.documentElement.clientWidth)},g.parseSrcset=function(a){for(var b=[];""!==a;){a=a.replace(/^\s+/g,"");var c,d=a.search(/\s/g),e=null;if(-1!==d){c=a.slice(0,d);var f=c.slice(-1);if((","===f||""===c)&&(c=c.replace(/,+$/,""),e=""),a=a.slice(d+1),null===e){var g=a.indexOf(",");-1!==g?(e=a.slice(0,g),a=a.slice(g+1)):(e=a,a="")}}else c=a,a="";(c||e)&&b.push({url:c,descriptor:e})}return b},g.parseDescriptor=function(a,b){var c,d=b||"100vw",e=a&&a.replace(/(^\s+|\s+$)/g,""),f=g.findWidthFromSourceSize(d);if(e)for(var h=e.split(" "),i=h.length-1;i>=0;i--){var j=h[i],k=j&&j.slice(j.length-1);if("h"!==k&&"w"!==k||g.sizesSupported){if("x"===k){var l=j&&parseFloat(j,10);c=l&&!isNaN(l)?l:1}}else c=parseFloat(parseInt(j,10)/f)}return c||1},g.getCandidatesFromSourceSet=function(a,b){for(var c=g.parseSrcset(a),d=[],e=0,f=c.length;f>e;e++){var h=c[e];d.push({url:h.url,resolution:g.parseDescriptor(h.descriptor,b)})}return d},g.dodgeSrcset=function(a){a.srcset&&(a[g.ns].srcset=a.srcset,a.srcset="",a.setAttribute("data-pfsrcset",a[g.ns].srcset))},g.processSourceSet=function(a){var b=a.getAttribute("srcset"),c=a.getAttribute("sizes"),d=[];return"IMG"===a.nodeName.toUpperCase()&&a[g.ns]&&a[g.ns].srcset&&(b=a[g.ns].srcset),b&&(d=g.getCandidatesFromSourceSet(b,c)),d},g.backfaceVisibilityFix=function(a){var b=a.style||{},c="webkitBackfaceVisibility"in b,d=b.zoom;c&&(b.zoom=".999",c=a.offsetWidth,b.zoom=d)},g.setIntrinsicSize=function(){var c={},d=function(a,b,c){b&&a.setAttribute("width",parseInt(b/c,10))};return function(e,f){var h;e[g.ns]&&!a.pfStopIntrinsicSize&&(void 0===e[g.ns].dims&&(e[g.ns].dims=e.getAttribute("width")||e.getAttribute("height")),e[g.ns].dims||(f.url in c?d(e,c[f.url],f.resolution):(h=b.createElement("img"),h.onload=function(){if(c[f.url]=h.width,!c[f.url])try{b.body.appendChild(h),c[f.url]=h.width||h.offsetWidth,b.body.removeChild(h)}catch(a){}e.src===f.url&&d(e,c[f.url],f.resolution),e=null,h.onload=null,h=null},h.src=f.url)))}}(),g.applyBestCandidate=function(a,b){var c,d,e;a.sort(g.ascendingSort),d=a.length,e=a[d-1];for(var f=0;d>f;f++)if(c=a[f],c.resolution>=g.getDpr()){e=c;break}e&&(e.url=g.makeUrl(e.url),b.src!==e.url&&(g.restrictsMixedContent()&&"http:"===e.url.substr(0,"http:".length).toLowerCase()?void 0!==window.console&&console.warn("Blocked mixed content image "+e.url):(b.src=e.url,g.curSrcSupported||(b.currentSrc=b.src),g.backfaceVisibilityFix(b))),g.setIntrinsicSize(b,e))},g.ascendingSort=function(a,b){return a.resolution-b.resolution},g.removeVideoShim=function(a){var b=a.getElementsByTagName("video");if(b.length){for(var c=b[0],d=c.getElementsByTagName("source");d.length;)a.insertBefore(d[0],c);c.parentNode.removeChild(c)}},g.getAllElements=function(){for(var a=[],c=b.getElementsByTagName("img"),d=0,e=c.length;e>d;d++){var f=c[d];("PICTURE"===f.parentNode.nodeName.toUpperCase()||null!==f.getAttribute("srcset")||f[g.ns]&&null!==f[g.ns].srcset)&&a.push(f)}return a},g.getMatch=function(a,b){for(var c,d=b.childNodes,e=0,f=d.length;f>e;e++){var h=d[e];if(1===h.nodeType){if(h===a)return c;if("SOURCE"===h.nodeName.toUpperCase()){null!==h.getAttribute("src")&&void 0!==typeof console&&console.warn("The `src` attribute is invalid on `picture` `source` element; instead, use `srcset`.");var i=h.getAttribute("media");if(h.getAttribute("srcset")&&(!i||g.matchesMedia(i))){var j=g.verifyTypeSupport(h);if(j===!0){c=h;break}if("pending"===j)return!1}}}}return c},a.HTMLPictureElement&&f(),e._=g,d(e)}(window,window.document,new window.Image);;
if(typeof Drupal!=="undefined"&&typeof jQuery!=="undefined"){(function(e){Drupal.behaviors.picture={attach:function(t){if(!("HTMLPictureElement"in window)){var n=e(t).find("img");if(n.length){window.picturefill({elements:n.get()})}}if(t==="#cboxLoadedContent"&&e(t).find("picture").length){e.colorbox.resize();e("img",t).once("colorbox-lazy-load",function(){e(this).load(function(){this.style.maxHeight=e(window).height()+"px";this.style.maxWidth=e(window).width()+"px";e.colorbox.resize({innerHeight:this.height,innerWidth:this.width});this.style.maxHeight=null;this.style.maxWidth=null})})}}}})(jQuery)}
;
(function($) {
  var $body = $('body'),
      $oc_mail = $('#block-dotmailer-rest-webform-dm-mail-icon-footer');

  initPage();

    // ------------------------------------ //
    // Initialize Page
    // -------------------------------------//

    function initPage() {

      // Adjustments to Markup That Can't Be Done Via Drupal Admin
      initMiscAdjustments();

      // Change .highlight background and text colors based on attributes
      initHighlights();

      // Lazy Loaded Images
      // initLazyImages();

      // HeadroomJS
      // initHeadroom();

      // Static Event Maps as the headline image backgrounds
      // initEventMap();

      // Slide-In Follow Buttons
      $('.slide-in').each(function() {
        $(this).find('.slide-in__toggle, .slide-in__close').on( "click", function() {
          $(this).parent().parent().toggleClass('slide-in--open');
        });
      });

      requirejs(['//cdnjs.cloudflare.com/ajax/libs/jquery-smooth-scroll/1.7.2/jquery.smooth-scroll.min.js'],
        function(smoothScroll) {
          // $('.front .l-banner').prepend('<div class="scroll-down"><a href="#block-views-releases-latest-release-block"></a></div>');
          // $('.scroll-down a').smoothScroll();
          $('.block--dotmailer-rest-webform .icon-mail').smoothScroll({speed:1000});
      });

      // Static Event Maps as the headline image backgrounds
      // initEventMap();

      $(window).on('load', function() {

        $('#block-menu-block-iga-common-socials-oc .menu').append($oc_mail);

        // Target the Drupal Legal menu item
        $('a.evidon-notice-link').click(function(e) {
          e.preventDefault();
          $('#_evh-link').click();
        });

        // Initialize Sticky Sidebar
        // initStickySidebar();

        // Trigger Slide In Follow Buttons on Load
        $('.slide-in .slide-in__toggle').trigger('click');

        setTimeout(function(){
          $('.slide-in').removeClass('slide-in--open');
        }, 3000);


        wayPoints();
        function wayPoints() {
          requirejs(['//cache.umusic.com/_sites/_halo/justinbieber/js/jquery.waypoints.min.js'],
          function (waypoints) {
            if($body.hasClass('front')) {

              var $homeBlock = $('.l-content > .block').length;

              $('.l-navigation').addClass('lite');

              var waypoints = $('.l-content > #block-views-releases-block-2', '.l-region--content-header').waypoint({
                handler: function(direction) {
                  $('.l-header .l-navigation').removeClass('lite');
                  if(direction == 'up') {
                    $('.l-header .l-navigation').removeClass('lite');
                  }
                },
                offset: '5%'
              });

              // var waypoints = $('.l-content > .block, .l-footer').waypoint({
              //   handler: function(direction) {


              //     $('.l-header .l-navigation').removeClass('lite');

              //     if(direction == 'up') {
              //       $('.l-header .l-navigation').addClass('lite');
              //     } else {
              //       this.element.classList.add('show');
              //     }
              //   },
              //   offset: '5%'
              // });

              var waypoints = $('.l-content > .block:nth-child(even)').waypoint({
                handler: function(direction) {
                  $('.l-header .l-navigation').addClass('lite');
                  if(direction == 'up') {
                    $('.l-header .l-navigation').removeClass('lite');
                  }
                  console.log('even block');
                }, offset: '5%'
              });

              var waypoints = $('.l-content > .block:nth-child(odd)').waypoint({
                handler: function(direction) {
                  $('.l-header .l-navigation').removeClass('lite');
                  if(direction == 'up') {
                    $('.l-header .l-navigation').addClass('lite');
                  }
                  console.log('odd block');
                }, offset: '5%'
              });

              if ($homeBlock % 2 === 0) {
                var waypoints = $('.l-footer').waypoint({
                  handler: function(direction) {
                    $('.l-header .l-navigation').removeClass('lite');
                    if(direction == 'up') {
                      $('.l-header .l-navigation').addClass('lite');
                    }
                    console.log('odd block');
                  }, offset: '5%'
                });
                 console.log('this is even blocks');
              }
              else {
                /* we are odd */
                var waypoints = $('.l-footer').waypoint({
                  handler: function(direction) {
                    $('.l-header .l-navigation').removeClass('lite');
                    if(direction == 'up') {
                      $('.l-header .l-navigation').removeClass('lite');
                    }
                    console.log('even block');
                  }, offset: '5%'
                });
                console.log('this is odd blocks');
              }

              var waypoints = $('#block-views-events-block-upcoming-summary').waypoint({
                handler: function(direction) {
                  $('#block-views-events-block-upcoming-summary').addClass('popup');
                }, offset: '5%'
              });

              var waypoints = $('#block-views-releases-block-2').waypoint({
                handler: function(direction) {
                  $('#block-views-releases-block-2 .bolero-sa-initialized').addClass('slick-active');
                }, offset: '5%'
              });

              setTimeout(function() {
                Waypoint.refreshAll();
              }, 1000);
            }
          });
        }
      });

      // Debounced Scroll and Resize Events
      requirejs(['underscore'],
        function(underscore) {

          // Initialize for non touch screen devices
          if (!$("html").hasClass("touch")) {

            // Determine whether or not to parallax header based on SASS
            var parallaxBG = window.getComputedStyle(
              document.querySelector('#page'), ':before'
            ).getPropertyValue('content');

            parallaxBG = parallaxBG.replace(/"/g, ""); // Remove double quotes

            // Set main banner carousel bgs to parallax if enable via SASS
            if (parallaxBG == 'parallax') {

              var dbMoveHeader = _.debounce(parallaxBanner, 10);
              $(window).resize(dbMoveHeader);
              $(window).scroll(dbMoveHeader);
              parallaxBanner();

            }

            /*var dbCheckOnScreen = _.debounce(checkOnScreen, 100);
            $(window).scroll(dbCheckOnScreen);
            $(window).resize(dbCheckOnScreen);
            checkOnScreen();*/

          }

          // Detect if scrolled more than 1px in order to add header shadow
          var dbScrolled = _.debounce(scrolledDown, 250);
          $(window).scroll(scrolledDown);
          scrolledDown();

        });
    }

  // ------------------------------------ //
  // Detect Webkit Browsers
  // ------------------------------------ //
  var isWebkit = 'WebkitAppearance' in document.documentElement.style;

  // ------------------------------------ //
  // Adjustments to Markup That Can't Be
  // Done via Drupal Admin
  // ------------------------------------ //
  function initMiscAdjustments() {

    if (GetIEVersion() > 0) {
      $('body').addClass('ie');
    } else {
      $('body').addClass('no-ie');
    }

    // Add wrapper for fixed sidebar
    $('.not-front .l-region--sidebar-first').wrapInner("<div class='js-sidebar'></div>");

    // Move webform icon into socials
    $(".l-header .block--dotmailer-rest-webform").appendTo(".l-header .block--menu-block-iga-common-socials-nav");
    $(".left-off-canvas-menu .block--dotmailer-rest-webform").appendTo(".left-off-canvas-menu .menu-block-iga_common_socials_oc .menu");


    // Add sidebar wrapper for fixed sidebars

    // If a user swipes the offcanvas trigger a menu close
    $(".touch .l-off-canvas").on("swipe", function(event) {
      $(".menu-icon.active").trigger('click');
    })

    $('.l-region--off-canvas .block--dotmailer-rest-webform .icon-mail').on("click", function() {
      $('.exit-off-canvas').trigger("click");
    });

    //$("#mailing-list .exacttarget-webform > div > div:not(.form-item), #mailing-list .exacttarget-webform > div > fieldset").wrapAll("<div class='webform-bottom' />");
    //$("#mailing-list .exacttarget-webform > div > .form-item").wrapAll("<div class='webform-fields' />");
    //$('.webform-fields').closest('.exacttarget-webform').addClass('js-customized');

    // $('.front .exacttarget-webform input').on('focus', function() {
    //   $(this).parent().find('label').addClass('focused');
    // });
    // $('.front .exacttarget-webform input').focusout(function() {
    //   $(this).parent().find('label').removeClass('focused');
    // });
  }

  // JB functions
  bannerSlider();
  initScrollMagic();

  if($body.hasClass('front')) {

    var release = $('#block-views-releases-block-2 .view-releases'),
        releaseArrows = '<div class="ss-arrows"><a href="#" title="Next" class="ss-arrow ss-arrow-next js-ss-next"><span class="icon-container"><i class="icon icon-angle-right icon-lnr"></i><i class="icon icon-angle-right icon-lnr-hover"></i></span></a><a href="#" title="Prev" class="ss-arrow ss-arrow-prev js-ss-prev"><span class="icon-container"><i class="icon icon-angle-left icon-lnr"></i><i class="icon icon-angle-left icon-lnr-hover"></i></span></a></div>';

    function breakLine() {

      $('.node--promo--hero h2, h2.js-break').each(function( index ) {
        var spanInserted = $(this).html().split(" ").join(" </span><span>");
        var wrapped = ("<span>").concat(spanInserted, "</span>");
        $(this).html(wrapped);
        var refPos = $(this).find('span:first-child').position().top;
        var newPos;
        $(this).find('span').each(function(index) {
            newPos = $(this).position().top
            if (index == 0){
              return;
            }
            if (newPos == refPos){
                $(this).prepend($(this).prev().text() + " ");
                $(this).prev().remove();
            }
            refPos = newPos;
        });
      });
    }

    setTimeout(function(){
      breakLine();
    }, 800);

    // release slider
    release.prepend(releaseArrows);

    $('.js-ss-next').on('click', function (e) {
      e.preventDefault();
      $('#block-views-releases-block-2 .slick-next').trigger('click');
    });
    $('.js-ss-prev').on('click', function (e) {
      e.preventDefault();
      $('#block-views-releases-block-2 .slick-prev').trigger('click');
    });

    $('.node--video .field--name-node-link').on('click', function(e) {
      e.preventDefault();

      var youtubeID = $(this).parent().find('.field--name-field-youtube-id').text(),
          embedCode = "<div class='media-youtube-video'><iframe src='https://www.youtube.com/embed/" + youtubeID + "?showinfo=0&autohide=1&rel=0&autoplay=1' frameborder='0' allow='accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture' allowfullscreen></iframe></div>";

      console.log(youtubeID);
      if (!document.querySelector('.media-youtube-video')) {
        $(this).parent().append(embedCode);
        setTimeout(function(){
          $('.node--video .ds-region--foreground').addClass('playing');
        }, 600);
      } else {
        $('.node--video .ds-region--foreground').removeClass('playing');
        $('.media-youtube-video').remove();
      }
    });
  } else {

    $(window).scroll(function() {
      if($(window).scrollTop() + $(window).height() == $(document).height()) {
          // $('.l-content > h1').css('bottom', '30px');
          $('.l-content > h1').addClass('btm');
      } else {
        $('.l-content > h1').removeClass('btm');
      }
    });
  }

  // set attr to buy links
  $('.entity-paragraphs-item .field a, .node--event .group-right a, .field--name-node-link a, .l-region--sidebar-first .more-link a, .pager-load-more a').each(function( index, value ) {
    // alert( index + ": " + value );
    // $('this').attr('title', value.text);
    // console.log(index);

    $(this).wrapInner('<span class="txt" data-name="'+value.text+'"></span>');
    // console.log('a' + index + ':' + $(this).attr('href'));
  });
  $('button.spotify').each(function( index, value ) {
    $(this).wrapInner('<span class="txt" data-name="'+$(this).find('.btn-text').text()+'"></span>');
  });

  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
  var mutationContainer = document.querySelector('.not-front .l-main .view-content');

  var observer = new MutationObserver(function (mutations, observer) {
    // fired when a mutation occurs
    if (mutations) {
      const createEleWithClass = (tag, className) => {
        const ele = document.createElement(tag);
        ele.className = className;
        return ele;
      };

      var newNodes = mutations[0].addedNodes;
      newNodes.forEach(function (node) {
        const warp = createEleWithClass('span', 'txt');
        $woot = node.querySelector('.field--name-node-link a');
        $text = $woot.innerHTML;
        warp.dataset.name = $text;
        warp.innerHTML = $text;
        // console.log($woot);
        // console.log(warp);
        $woot.innerHTML = " ";
        $woot.appendChild(warp);

        // $woot.empty().append('<span class="txt" data-name="'+$text+'"></span>');
      });
    }
  });

  // if(!$body.hasClass('front')) {
  if($body.hasClass('page-tour')) {
    observer.observe(mutationContainer, {
      childList: true,
      characterData: true,
      subtree: false,
      attributes: false
    });
  }

  function bannerSlider() {
    requirejs(['//cache.umusic.com/_sites/_halo/justinbieber/js/slick.min-b.js'],
    function (slick) {
      var banner = $('.l-region--content-header'),
          bannerItem = $('.node--promo--hero').length,
          bannerPagin = '<div class="ss-arrows"><a href="#" title="Next" class="ss-arrow ss-arrow-next js-lb-next"><span class="icon-container"><i class="icon icon-angle-right icon-lnr"></i><i class="icon icon-angle-right icon-lnr-hover"></i></span></a><div class="lb-pager"></div><a href="#" title="Prev" class="ss-arrow ss-arrow-prev js-lb-prev"><span class="icon-container"><i class="icon icon-angle-left icon-lnr"></i><i class="icon icon-angle-left icon-lnr-hover"></i></span></a></div>',
          bannerPromoArrow = '<span class="icon-container"><i class="icon icon-angle-right icon-lnr"></i><i class="icon icon-angle-right icon-lnr-hover"></i></span>';


      banner.slick({
        dots: true
      });

      if(bannerItem > 1) {
        $('.l-region--content-header .node--promo--hero').find('.field--name-field-promo-links a').append(bannerPromoArrow);
        banner.append(bannerPagin);
      }

      $('.lb-pager').text(1 + '/' + bannerItem);

      $('[class*="js-lb-"]').on('click', function(e){
        setTimeout(function(){
          $('.lb-pager').text((parseInt(banner.find('.slick-active').attr('data-slick-index')) + 1) + '/' + bannerItem);
        }, 100);
      });

      $('.js-lb-next').on('click', function (e) {
        e.preventDefault();
        $('.l-region--content-header .slick-next').trigger('click');
        console.log('banner next');
      });
      $('.js-lb-prev').on('click', function (e) {
        e.preventDefault();
        $('.l-region--content-header .slick-prev').trigger('click');
        console.log('banner prev');
      });

      banner.on('afterChange', function(event, slick, currentSlide){
        $('.lb-pager').text((parseInt(banner.find('.slick-active').attr('data-slick-index')) + 1) + '/' + bannerItem);
      });

      $('.l-region--content-header .slick-current, #block-views-releases-block-2 .bolero-sa-initialized').removeClass('slick-active');

      setTimeout(function(){
        banner.addClass('init');

        setTimeout(function(){
          $('.l-region--content-header .slick-current').addClass('slick-active');
        }, 500);
      }, 800);

    });
  }

  function initScrollMagic() {
    requirejs(['//cache.umusic.com/_sites/_halo/ccmg/js/ScrollMagic.min.js'],
    function (ScrollMagic) {
      $('#block-views-releases-block-2, #block-views-events-block-upcoming-summary, #block-views-daf2311121c077670343ad2c252e098c, #block-views-videos-block-latest-video, .front #mailing-list').each(function (index) {
        var controller = new ScrollMagic.Controller();
        var currentEl = this;

        var blockScene = new ScrollMagic.Scene({
          triggerElement: currentEl,
          offset: 400,
          triggerHook: '1'
        })
        .setClassToggle(currentEl, 'animate-in')
        // .reverse(false)
        .addTo(controller)
      });

      $('.node--event').each(function(index) {
        var controller = new ScrollMagic.Controller();
        var currentEl = this;

        var nodescene = new ScrollMagic.Scene({
          triggerElement: currentEl,
          offset: -100,
          triggerHook: 'onEnter'
        })
        .setClassToggle(currentEl, 'animate-in')
        // .reverse(false)
        .addTo(controller)
      });
    });
  }


  // ------------------------------------ //
  // Add a static Google Map snapshot
  // of the venue location on event
  // detail pages
  // ------------------------------------ //

  function initEventMap() {

    // Add static maps to event headers - Malcolm's getting this set up so that it's server side
    $(".node-type-event").each(function() {
      var mapKey = "AIzaSyBdpOJFEzveqznnUUdedp7Xsd58QggXqfA";
      var mapLoc = $('.l-banner .field--name-asf-events-venue-title .field__item').html() + '+' + $('.l-banner .locality').html() + '+' + $('.l-banner .area').html();
      var parsedMapLoc = encodeURIComponent(mapLoc);
      //var mapImg = '//maps.googleapis.com/maps/api/staticmap?center=' + parsedMapLoc + '&size=800x300&scale=2&style=element:labels|visibility:off&style=element:geometry.stroke|visibility:off&style=feature:landscape|element:geometry|saturation:-100&style=feature:water|saturation:-100|invert_lightness:true&key=AIzaSyBdpOJFEzveqznnUUdedp7Xsd58QggXqfA';
      // Use Snazzy Map converter here http://jsfiddle.net/gaby/s6Dyp/
      var darkStyle = '&style=feature:all|element:labels.text.fill|saturation:36|color:0x000000|lightness:40&style=feature:all|element:labels.text.stroke|visibility:on|color:0x000000|lightness:16&style=feature:all|element:labels.icon|visibility:off&style=feature:administrative|element:geometry|visibility:off|color:0x000000&style=feature:administrative|element:geometry.fill|lightness:20|color:0x000000|visibility:off&style=feature:administrative|element:geometry.stroke|color:0x000000|lightness:17|weight:1.2|visibility:off&style=feature:administrative|element:labels.text.fill|visibility:on|color:0xdbdbdb&style=feature:landscape|element:geometry|color:0x212325|lightness:20&style=feature:landscape.man_made|element:geometry|visibility:off&style=feature:poi|element:geometry|color:0x6b2f2f|lightness:21|visibility:off&style=feature:poi|element:labels.text|visibility:off&style=feature:road|element:labels.text|visibility:simplified&style=feature:road|element:labels.text.fill|color:0x858585&style=feature:road.highway|element:geometry.fill|color:0x000000|lightness:17|visibility:on&style=feature:road.highway|element:geometry.stroke|color:0x000000|lightness:29|weight:0.2&style=feature:road.highway|element:labels.text|visibility:off&style=feature:road.arterial|element:geometry|color:0x000000|lightness:18|visibility:on&style=feature:road.arterial|element:labels.text|visibility:on&style=feature:road.arterial|element:labels.text.stroke|visibility:on&style=feature:road.local|element:geometry|color:0x000000|lightness:16&style=feature:transit|element:geometry|color:0x000000|lightness:19&style=feature:water|element:geometry|color:0x000000|lightness:17';
      var lightStyle = '&style=feature:water|element:geometry|color:0xe9e9e9|lightness:17&style=feature:landscape|element:geometry|color:0xf5f5f5|lightness:20&style=feature:road.highway|element:geometry.fill|color:0xffffff|lightness:17&style=feature:road.highway|element:geometry.stroke|color:0xffffff|lightness:29|weight:0.2&style=feature:road.arterial|element:geometry|color:0xffffff|lightness:18&style=feature:road.local|element:geometry|color:0xffffff|lightness:16&style=feature:poi|element:geometry|color:0xf5f5f5|lightness:21&style=feature:poi.park|element:geometry|color:0xdedede|lightness:21&style=element:labels.text.stroke|visibility:on|color:0xffffff|lightness:16&style=element:labels.text.fill|saturation:36|color:0x333333|lightness:40&style=element:labels.icon|visibility:off&style=feature:transit|element:geometry|color:0xf2f2f2|lightness:19&style=feature:administrative|element:geometry.fill|color:0xfefefe|lightness:20&style=feature:administrative|element:geometry.stroke|color:0xfefefe|lightness:17|weight:1.2';
      var mapStyle = darkStyle;
      var mapImg = '//maps.googleapis.com/maps/api/staticmap?&size=640x240&scale=2&center=' + parsedMapLoc + '' + mapStyle + '&key=AIzaSyBdpOJFEzveqznnUUdedp7Xsd58QggXqfA';
      $('.block--views-events-event-headline').append('<div class="event-map"></div>');
      $('.block--views-events-event-headline .event-map').css({
        'background-image': 'url(' + mapImg + ')',
      });

    });

  }

  // ------------------------------------ //
  // Add a 'scrolled' class to the html tag
  // (when the user scrolls down) so that
  // we can use Modernizr to detect
  // ------------------------------------ //
  function scrolledDown() {
    var scroll = getCurrentScroll();
    if (scroll >= 1) {
      $('html').addClass('scrolled');
    } else {
      $('html').removeClass('scrolled');
    }
  }

  function getCurrentScroll() {
    return window.pageYOffset || document.documentElement.scrollTop;
  }


  // ------------------------------------ //
  // Parallax Banner Images
  // ------------------------------------ //
  function parallaxBanner() {
    scrollTotal = $(window).scrollTop();
    scrollTotal = Math.floor(scrollTotal / 5);
    $(".l-banner .ds-region--background > div").css({
      transform: "translate3d(0, " + scrollTotal + "px, 0px)"
    })
  }

  // ------------------------------------ //
  // Add custom .hihlight  background colors
  // using data-color and data-textcolor attributes
  // ------------------------------------ //
  function initHighlights() {

    // Set banner highlight colors
    $(".highlight").each(function() {
      $(this).css('background-color', function() { //or for code's consistency, i'd use background-color instead
        return $(this).data('color')
      });
    });

    // Set banner highlight colors
    $(".highlight").each(function() {
      $(this).css('color', function() { //or for code's consistency, i'd use background-color instead
        return $(this).data('textcolor')
      });
    });

  }


  // ------------------------------------ //
  // Add lazyload properties to images
  // http://www.appelsiini.net/projects/lazyload
  // -------------------------------------//
  function initLazyImages() {
    // Add lazyload properties to images
    if (isWebkit) {

      // For img tags
      $(".l-main .ds-region--background img, .l-main .ds-region--feature-background img, .l-main .field--name-field-headline-image img, .l-footer img, .field--name-field-release-cover img, .field--name-field-photo img, .l-main .field--name-body img").each(function() {
        // Only lazyload if below viewport
        if ($(this).offset().top > $(window).height()) {
          $(this).addClass('lazy');
          $(this).attr('data-original', $(this).attr('src'));
          $(this).attr('src', '//cache.umusic.com/_sites/kipmoore.net/images/blank.gif');
        }
      });

      // For background images
      $(".bolero-background-image").each(function() {
        // Only lazyload if below viewport
        if ($(this).offset().top > $(window).height()) {
          $(this).addClass('lazy');
          var bg = $(this).css('background-image');
          bg = bg.replace('url(', '').replace(')', '');
          bg = bg.replace('"', '').replace('"', '');
          $(this).attr('data-original', bg);
        }
      });

    }

    // Lazyload
    requirejs(['//cache.umusic.com/_sites/kipmoore.net/js/jquery.lazyload.js?v=1.9.1'],

      function(lazyload) {

        $("img.lazy, div.lazy").lazyload({
          effect: "fadeIn"
        });

      }); // End requirejs

  }

  // ------------------------------------ //
  // HeadroomJS
  // http://wicky.nillia.ms/headroom.js
  // -------------------------------------//
  function initHeadroom() {
    // HeadroomJS - http://wicky.nillia.ms/headroom.js/
    requirejs(['//cdnjs.cloudflare.com/ajax/libs/headroom/0.7.0/headroom.min.js', '//cdnjs.cloudflare.com/ajax/libs/headroom/0.7.0/jQuery.headroom.min.js'],
      function(headroom, jqheadroom) {
        if ($('body').hasClass('front')) {
          bannerOffset = $(".l-banner").height();
        } else {
          bannerOffset = 300;
        }
        //subheaderOffset = $(".l-subheader").height() - 30;
        $(".sticky").headroom({
          "offset": bannerOffset,
          "tolerance": 5,
          "classes": {
            "initial": "animated",
            "pinned": "slideDown",
            "unpinned": "slideUp"
          },
          // callback when above offset, `this` is headroom object
          onTop: function() {},
          // callback when below offset, `this` is headroom object
          onNotTop: function() {}
        });

      }); // End requirejs
  }

  // ------------------------------------ //
  // // Sticky Sidebar
  // -------------------------------------//

  function initStickySidebar() {

    if ($('.not-front .l-page').hasClass('has-one-sidebar') && $('.js-sidebar').height() < $('.l-content').height()) {

      var stickyTop = $('.not-front .l-region--sidebar-first').offset().top; // returns number

      $(window).scroll(function() { // scroll event

        var windowTop = $(window).scrollTop(); // returns number

        if (stickyTop < windowTop) {
          //$('.js-sidebar').css({ position: 'fixed', top: 0 });
          $('.js-sidebar').removeClass('js-static');
          $('.js-sidebar').addClass('js-fixed');
        } else {
          //$('.js-sidebar').css('position','static');
          $('.js-sidebar').removeClass('js-fixed');
          $('.js-sidebar').addClass('js-static');
        }

      });
    }

  }

  // ------------------------------------ //
  // Check if views are on the screen
  // -------------------------------------//

  $.fn.isOnScreen = function() {

    var win = $(window);
    win.trigger('scroll');

    var viewport = {
      top: win.scrollTop(),
      left: win.scrollLeft()
    };
    viewport.right = viewport.left + win.width();
    viewport.bottom = viewport.top + win.height();

    var bounds = this.offset();
    bounds.right = bounds.left + this.outerWidth();
    bounds.bottom = bounds.top + this.outerHeight();

    return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));

  };

  function checkOnScreen() {

    $(".view").not('.views-loaded').each(function() {
      if ($(this).isOnScreen() == true) {
        $(this).addClass('on-screen');
      }
    });

  }

  // ------------------------------------ //
  // Normalize Carousel Heights
  // -------------------------------------//

  $.fn.carouselHeights = function() {

    var items = $(this), //grab all slides
      heights = [], //create empty array to store height values
      tallest; //create variable to make note of the tallest slide

    var normalizeHeights = function() {

      items.each(function() { //add heights to array
        heights.push($(this).height());
      });
      tallest = Math.max.apply(null, heights); //cache largest value
      items.each(function() {
        $(this).css('height', tallest + 'px');
      });
    };

    normalizeHeights();

    $(window).on('resize orientationchange', function() {
      //reset vars
      tallest = 0;
      heights.length = 0;

      items.each(function() {
        $(this).css('height', '0'); //reset min-height
      });
      normalizeHeights(); //run it again
    });

  };

  function GetIEVersion() {
    var sAgent = window.navigator.userAgent;
    var Idx = sAgent.indexOf("MSIE");

    // If IE, return version number.
    if (Idx > 0) {
      return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf(".", Idx)));
    }
    // If IE 11 then look for Updated user agent string.
    else if (!!navigator.userAgent.match(/Trident\/7\./)) {
      return 11;
    } else {
      return 0; //It is not IE
    }
  }

})(jQuery); // end of jQuery name space

require(["IGA.utils"]);

// Foundation libraries
//define("foundation/foundation.topbar", ["foundation.topbar"]);;
